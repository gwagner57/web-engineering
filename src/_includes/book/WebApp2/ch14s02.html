<html>
<!-- Mirrored from web-engineering.info/book/WebApp2/ch14s02.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 21 Jul 2023 11:00:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>2.&nbsp;Case Study 1: Implement a Class Hierarchy with Single Table Inheritance</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index-2.html" title="Web Applications with JavaScript or Java"><link rel="up" href="ch14.html" title="Chapter&nbsp;14.&nbsp;Subtyping with Java EE"><link rel="prev" href="ch14s01.html" title="1.&nbsp;Subtyping in Java"><link rel="next" href="ch14s03.html" title="3.&nbsp;Case Study 2: Implement a Class Hierarchy with Joined Table Inheritance"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.&nbsp;Case Study 1: Implement a Class Hierarchy with <span class="italic">Single Table Inheritance</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch14s01.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;14.&nbsp;Subtyping with Java EE</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch14s03.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e5406"></a>2.&nbsp;Case Study 1: Implement a Class Hierarchy with <span class="italic">Single Table Inheritance</span></h2></div></div></div><p>In this example we implement the Book hierarchy shown in <a class="xref" href="ch12s01.html#figBookClassHierarchy" title="Figure&nbsp;12.1.&nbsp;The object type Book with two subtypes: TextBook and Biography">Figure&nbsp;12.1</a>. The Java <span class="italic">Entity class model</span> is derived from this design model.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5412"></a>2.1.&nbsp;Make the Java Entity class model</h3></div></div></div><p>Recall that we obtain a Java Entity class model<a class="indexterm" name="d5e5415"></a>from an OO class model by (1) making all properties private, (2) using Java datatype classes, (3) adding public getters and setters, (4) adding a <code class="code">toString</code> function, (5) adding the (static) data storage methods <code class="code">create</code>, <code class="code">retrieve</code>, <code class="code">update</code> and <code class="code">delete</code>, resulting in the model shown in <a class="xref" href="ch14s02.html#figBookClassHierarchyJEE" title="Figure&nbsp;14.1.&nbsp;The Java Entity class model of the Book class hierarchy">Figure&nbsp;14.1</a>.</p><div class="figure"><a name="figBookClassHierarchyJEE"></a><div class="figure-title">Figure&nbsp;14.1.&nbsp;The Java Entity class model of the Book class hierarchy</div><div class="figure-contents"><div class="mediaobject"><img src="resources/BookClassHierarchy_JEE.png"></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5429"></a>2.2.&nbsp;New issues</h3></div></div></div><p>We have to deal with a number of new issues: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>In the <span class="italic">model code</span> we have to take care of:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Coding the enumeration type (<code class="code">BookCategoryEL</code>) that is used in the UI code for creating a selection list widget that allows choosing the category of book.</p></li><li class="listitem"><p>Code each class from the <code class="code">Book</code> class hierarchy using suitable JPA annotations for persistent storage in a corresponding database table, like <code class="code">books</code>.</p></li></ol></div></li><li class="listitem"><p>In the <span class="italic">UI code</span> we have to take care of:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Adding a "Special type" column to the display table of the "retrieve/list all books" use case in <code class="filename">retrieveAndListAll.xhtml</code> in the folder <code class="filename">WebContent/views/books/</code>. A book without a special category will have an empty table cell, while for all other books their category will be shown in this cell, along with other segment-specific attribute values.</p></li><li class="listitem"><p>Adding a "Special type" select control, and corresponding form fields for all segment properties, in the forms of the "Create book" and "Update book" use cases in <code class="filename">create.xhtml</code> and <code class="filename">update.xhtml</code> in the folder <code class="filename">WebContent/views/books/</code>. Segment property form fields are only displayed, and their validation is performed, when a corresponding book category has been selected. Such an approach of rendering specific form fields only on certain conditions is sometimes called <span class="italic">dynamic forms</span>.</p></li></ol></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5458"></a>2.3.&nbsp;Code the classes of the Java Entity class model</h3></div></div></div><p>The Java Entity class model can be directly coded for getting the code of the model classes of our Java EE back-end app.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d5e5461"></a>2.3.1.&nbsp;Summary</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Code the enumeration type (to be used in the facelets) .</p></li><li class="listitem"><p>Code the model classes and add the corresponding JPA annotations for class hierarchy.</p></li></ol></div><p>These steps are discussed in more detail in the following sections.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d5e5469"></a>2.3.2.&nbsp;Code the enumeration type <code class="code">BookCategoryEL</code></h4></div></div></div><p>The enumeration type <code class="code">BookCategoryEL</code> is coded as a Java <code class="code">enum</code>, providing both enumeration literals as well as (human-readable) labels:</p><pre class="programlisting">public enum BookCategoryEL {
  TEXTBOOK("TextBook"), BIOGRAPHY("Biography");
  private final String label;

  private BookCategoryEL( String label) {
    this.label = label;
  }
  public String getLabel() {return this.label;}
}</pre><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="d5e5476"></a>2.3.2.1.&nbsp;Code the model classes</h5></div></div></div><p>We code the model classes <code class="code">Book</code>, <code class="code">TextBook</code> and <code class="code">Biography</code> in the form of Java Entity classes using suitable JPA annotations: </p><pre class="programlisting">@Entity @Table( name="books")
<span class="bold"><strong>@Inheritance</strong></span>( strategy=InheritanceType.<span class="bold"><strong>SINGLE_TABLE</strong></span>)
<span class="bold"><strong>@DiscriminatorColumn</strong></span>( name="category", 
    discriminatorType=DiscriminatorType.STRING, length=16)
<span class="bold"><strong>@DiscriminatorValue</strong></span>( value="BOOK")
@ManagedBean( name="book") @ViewScoped
public class Book {
  @Id @Column( length=10)
  @NotNull( message="An ISBN is required!")
  @Pattern( regexp="\\b\\d{9}(\\d|X)\\b", 
      message="The ISBN must be a ...!")
  private String isbn;
  @Column( nullable=false) @NotNull( message="A title is required!")
  private String title;
  @Column( nullable=false) @NotNull( message="A year is required!")
  @UpToNextYear
  @Min( value=1459, message="The year must not be before 1459!")
  private Integer year;
  // constructors, set, get and other methods
  ...
}</pre><p>When using the JPA Single Table Inheritance technique for a class hierarchy, the <code class="code">@Inheritance</code> annotation must be set for the superclass (e.g, <code class="code">Book</code> in our example). It provides the <code class="code">strategy</code> parameter with the value <code class="code">InheritanceType.SINGLE_TABLE</code>. The <code class="code">@DiscriminatorColumn</code> annotation specifies the name of the table column storing the values that discriminate between different types of subclasses (<code class="code">TextBook</code> and <code class="code">Biography</code>, in our example).</p><p>Unfortunately, we cannot use our <code class="code">BookCategoryEL</code> enumeration for defining the type of the discriminator column, because Java expressions like <code class="code">BookCategoryEL.TEXTBOOK.name()</code> are not constant, so a Java compiler exception is thrown. Instead, we use <code class="code">DiscriminatorType.STRING</code>. The <code class="code">@DiscriminatorValue</code> annotation specifies a unique value to be stored in the discriminator column of table rows representing an instance of the given class.</p><p>Further, we define the subtypes <code class="code">TextBook</code> and <code class="code">Biography</code>:</p><pre class="programlisting">@Entity @Table( name="textbooks")
@DiscriminatorValue( value="TEXTBOOK")
@ManagedBean( name="textBook") @ViewScoped
public class <span class="bold"><strong>TextBook extends Book</strong></span> {
  @Column( nullable=false) @NotNull( 
      message="A subject area value is required")
  String subjectArea;
  // constructors, set, get and other methods
  ...
}</pre><p><code class="code">TextBook</code> and <code class="code">Biography</code> are subclasses of <code class="code">Book</code>, so we define them with <code class="code">extends Book</code>. For each subclass, we add a <code class="code">@DiscriminatorValue</code> annotation with a value from the <code class="code">BookCategoryEL</code> enumeration.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5512"></a>2.4.&nbsp;STI database schema</h3></div></div></div><p>As a result of the annotation </p><pre class="programlisting">@Inheritance( strategy=InheritanceType.SINGLE_TABLE)</pre><p> only one database table is used for representing a class hierarchy. This table contains the columns corresponding to all the properties of all the classes from the hierarchy plus the discriminator column. In our example, the <code class="code">books</code> table contains the following columns: <code class="code">isbn</code>, <code class="code">title</code>, <code class="code">year</code>, <code class="code">subjectArea</code>, <code class="code">about</code> and <code class="code">category</code>. The simplified corresponding SQL-DDL code internally used to generate the <code class="code">books</code> table for our application is shown below:</p><pre class="programlisting">CREATE TABLE IF NOT EXISTS `books` (
  `ISBN` varchar(10) NOT NULL,
  `TITLE` varchar(255) NOT NULL,
  `YEAR` int(11) NOT NULL,
  `SUBJECTAREA` varchar(255) DEFAULT NULL,
  `ABOUT` varchar(255) DEFAULT NULL,
  `category` varchar(16) DEFAULT NULL,
) </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e5525"></a>2.5.&nbsp;Write the view and controller code</h3></div></div></div><p>The user interface (UI) consists of a start page that allows navigating to the data management pages (in our example, to <code class="filename">index.xhtml</code> in the folder <code class="filename">WebContent/views/books/</code>). Such a data management page contains four sections: <span class="italic">retrieve/list all books</span>, <span class="italic">create book</span>, <span class="italic">update book</span> and <span class="italic">delete book</span>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d5e5534"></a>2.5.1.&nbsp;Summary</h4></div></div></div><p>We have to take care of handling the category discriminator and the <code class="code">subjectArea</code> and <code class="code">about</code> segment properties both in the "List all books" use case as well as in the "Create book" and "Update book" use cases by</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Adding a segment information column ("Special type") to the display table of the <span class="emphasis"><em>Retrieve/List All</em></span> use case in <code class="filename">retrieveAndListAll.xhtml</code> in the folder <code class="filename">WebContent/views/books/</code>.</p></li><li class="listitem"><p>Adding a "Special type" select control, and corresponding form fields for all segment properties, in the forms of the "Create book" and "Update book" use cases in <code class="filename">create.xhtml</code> and <code class="filename">update.xhtml</code> in the folder <code class="filename">WebContent/views/books/</code>. Segment property form fields are only displayed, and their validation occurs only when a corresponding book category has been selected.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d5e5550"></a>2.5.2.&nbsp;Add a segment information column in <span class="emphasis"><em>Retrieve/List All</em></span></h4></div></div></div><p>We add a "Special type" column to the display table of the "List all books" use case in <code class="code">books.html</code>:</p><pre class="programlisting">&lt;h:dataTable value="#{bookController.books}" var="b"&gt;
  ...
  &lt;h:column&gt;
    &lt;f:facet name="header"&gt;Special type&lt;/f:facet&gt;
    #{b.getClass().getSimpleName() != 'Book' ? 
        b.getClass().getSimpleName() : ''}
  &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre><p>A conditional expression is used to check if the Java bean class name is <code class="code">Book</code>, in which case we don't show it, or if it is something else (e.g. <code class="code">TextBook</code> or <code class="code">Biography</code>), and then it is shown. This expression also shows how you can call/use various Java bean methods, not only custom methods.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d5e5560"></a>2.5.3.&nbsp;Add a "Special type" select control in <span class="emphasis"><em>Create</em></span> and <span class="emphasis"><em>Update</em></span></h4></div></div></div><p>In both use cases, we need to allow selecting a special category of book ('textbook' or 'biography') with the help of a select control in a <span class="italic">panel grid</span> element:</p><pre class="programlisting">&lt;h:panelGrid id="bookPanel" columns="3"&gt;
  ...
  &lt;h:outputText value="Special type: " /&gt;
  <span class="bold"><strong>&lt;h:selectOneMenu id="bookType" value="#{viewScope.bookTypeVal}"&gt;</strong></span>
    &lt;f:selectItem itemLabel="---"/&gt;
    &lt;f:selectItems value="#{book.typeItems}" /&gt;
    <span class="bold"><strong>&lt;f:ajax event="change" execute="@this" 
      render="textBookPanel biographyBookPanel standardBookPanel"/&gt;</strong></span>
  &lt;/h:selectOneMenu&gt;
  &lt;h:message for="bookType" errorClass="error" /&gt;
&lt;/h:panelGrid&gt;</pre><p>In the select control, three alternative <span class="italic">panel groups</span> are referenced:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A "standardBookPanel":</p><pre class="programlisting">&lt;h:panelGroup id="standardBookPanel"&gt;  
  &lt;h:commandButton value="Create" 
       <span class="bold"><strong>rendered="#{viewScope.bookTypeVal == null}"</strong></span>
       action="#{bookController.create( book.isbn, 
           book.title, book.year)}" /&gt;
&lt;/h:panelGroup&gt;</pre></li><li class="listitem"><p>A "textBookPanel":</p><pre class="programlisting">&lt;h:panelGroup id="textBookPanel"&gt;  
  &lt;h:panelGrid <span class="bold"><strong>rendered="#{viewScope.bookTypeVal == 'TEXTBOOK'}"</strong></span> 
       columns="3"&gt;
    &lt;h:outputText value="Subject area: " /&gt;
    &lt;h:inputText id="subjectArea" value="#{textBook.subjectArea}"/&gt;
    &lt;h:message for="subjectArea" errorClass="error" /&gt;
  &lt;/h:panelGrid&gt;
  &lt;h:commandButton value="Create" 
       <span class="bold"><strong>rendered="#{viewScope.bookTypeVal == 'TEXTBOOK'}"</strong></span>
       <span class="bold"><strong>action="#{textBookController.create( book.isbn, book.title, 
           book.year, textBook.subjectArea)}"</strong></span> /&gt;
&lt;/h:panelGroup&gt;</pre></li><li class="listitem"><p>A "biographyBookPanel":</p><pre class="programlisting">&lt;h:panelGroup id="biographyBookPanel"&gt;  
  &lt;h:panelGrid <span class="bold"><strong>rendered="#{viewScope.bookTypeVal == 'BIOGRAPHY'}"</strong></span> 
       columns="3"&gt;
    &lt;h:outputText value="About: " /&gt;
    &lt;h:inputText id="about" value="#{biographyBook.about}"/&gt;
    &lt;h:message for="about" errorClass="error" /&gt;
  &lt;/h:panelGrid&gt;
  &lt;h:commandButton <span class="bold"><strong>value="Create" 
       rendered="#{viewScope.bookTypeVal == 'BIOGRAPHY'}"</strong></span>
       <span class="bold"><strong>action="#{biographyBookController.create( book.isbn,  
           book.title, book.year, biographyBook.about)}"</strong></span> /&gt;
&lt;/h:panelGroup&gt;</pre></li></ol></div><p>There are a few important remarks on the above code:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>the <code class="code">h:selectOneMenu</code> is used to create a single selection list which is populated with book titles by using the <code class="code">getTypeItems</code> method of the <code class="code">Book</code> class. A more detailed explanation is presented in Part 3 <a class="link" href="EnumerationApp/index.html" target="_top">enumeration app</a>.</p></li><li class="listitem"><p>it is possible to conditionally render facelet components by using the <code class="code">rendered</code> attribute. The JSF EL expression must return <code class="code">true</code> or <code class="code">false</code>, this making the HTML resulting elements to be part of the HTML DOM or not. Notice that the conditional expressions are evaluated in the server side. This is the method we use to hide or show the input form elements corresponding to various book types (e.g., <code class="code">TextBook</code> has a <code class="code">subjectArea</code> property while Biography has an <code class="code">about</code> property).</p></li><li class="listitem"><p>the <code class="code">render</code> attribute used with <code class="code">f:ajax</code> specifies which of the JSF components are to be updated . This is needed because of the live DOM changes (client side, not server side) which applies after the AJAX call.</p></li><li class="listitem"><p>AJAX is used to submit the form for reevaluation when the special type selection list field is changed (something is selected). As a result, it enforces the rendering of the three panels corresponding to three book cases: simple book, text book and biography. Using <code class="code">execute="@this"</code> we enforce the re-evaluation of the form at server side, so the resulting HTML DOM structure contains the changes accordiong to the conditions specified by the <code class="code">rendered</code> attributes of the various JSF elements. Notice that a JSF element that has a conditional <code class="code">rendered</code> expression must be a child of another JSF element which is always part of the DOM.</p></li><li class="listitem"><p><code class="code">h:panelGroup</code> is used to define a set of elements which are either shown or hidden.</p></li><li class="listitem"><p>the <code class="code">action</code> attribute of the <code class="code">h:commandButton</code> can't be used with conditional expressions, therefore we have to create three command buttons, one for each case: create/update a <code class="code">Book</code>, a <code class="code">TextBook</code> or a <code class="code">Biography</code>. The <code class="code">create</code> method of the corresponding controller class (i.e., <code class="code">BookController</code>, <code class="code">TextBookController</code> or <code class="code">BiographyController</code> is called).</p></li><li class="listitem"><p>since we do not have a corresponding property in the Java bean class(es) for the special type (category), we can use JSF variables to store the value of the single select list, and then use the variable in <code class="code">rendered</code> conditions for various elements. Therefore, for the <code class="code">h:selectOneMenu</code>, the <code class="code">value="#{viewScope.bookTypeVal}"</code> specifies that we use a "on the fly" defined property named <code class="code">bookTypeVal</code>, which is part of the view scope internal JSF object(s). We can also define such variable outside the view scope, e.g.,<code class="code"> value="#{bookTypeVal}"</code>, but in this case they are request scoped, so their value is lost after submitting the form, and the <code class="code">rendered</code> conditions can't be correctly evaluated.</p></li></ul></div><p>For a class in the class hierarchy, one corresponding controller class is defined. It contains the specific <code class="code">create</code>, <code class="code">update</code> and <code class="code">delete</code> methods. The shared methods, such as <code class="code">getAllObjects</code> are defined by the controller of the top level class (e.g., for our example, this is <code class="code">BookController</code>). See <a class="link" href="MinimalApp/index.html" target="_top">minimal app</a> for more details on how to implement the controller class and the corresponding CRUD methods.</p><p>The <span class="italic">Update Book</span> test case is very similar with the <span class="italic">Create Book</span> test case. The <span class="italic">Delete Book</span> test case remains unchanged, see See <a class="link" href="MinimalApp/index.html" target="_top">minimal app</a> for more details.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch14s01.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch14.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch14s03.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">1.&nbsp;Subtyping in Java&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index-2.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;3.&nbsp;Case Study 2: Implement a Class Hierarchy with <span class="italic">Joined Table Inheritance</span></td></tr></table></div></body>
<!-- Mirrored from web-engineering.info/book/WebApp2/ch14s02.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 21 Jul 2023 11:00:23 GMT -->
</html>