<html>
<!-- Mirrored from web-engineering.info/book/WebApp1/ch09s05.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 21 Jul 2023 10:59:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>5.&nbsp;Write the View Code</title><link rel="stylesheet" type="text/css" href="../docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index-2.html" title="Web Applications with JavaScript or Java"><link rel="up" href="ch09.html" title="Chapter&nbsp;9.&nbsp;Implementing Constraint Validation in a Java EE Web App"><link rel="prev" href="ch09s04.html" title="4.&nbsp;Write the Model Code"><link rel="next" href="ch09s06.html" title="6.&nbsp;Defining a Custom Validation Annotation"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.&nbsp;Write the View Code</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch09s04.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;9.&nbsp;Implementing Constraint Validation in a Java EE Web App</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch09s06.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e6230"></a>5.&nbsp;Write the View Code</h2></div></div></div><p>After we have defined the constraints in the Java EE model layer and
    the database layer, we need to take care of validation in the user
    interface. In particular, we need to make sure that the user gets informed
    about issues by rendering visual indicators and informative validation
    error messages.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6233"></a>5.1.&nbsp;Validation in the <span class="italic">Create</span> use
      case</h3></div></div></div><p>The <code class="filename">WebContent/views/books/create.xhtml</code> file contains the JSF
    facelet code for creating a new <code class="code">Book</code> record. We now use the JSF
     <code class="code">validator</code> attribute for performing the uniqueness validation and JSF
     <code class="code">message</code> elements for displaying validation error messages.</p><pre class="programlisting">&lt;ui:composition template="/WEB-INF/templates/page.xhtml"&gt;
  &lt;ui:define name="headerTitle"&gt;
    &lt;h1&gt;Create a new book record&lt;/h1&gt;
  &lt;/ui:define&gt;
  &lt;ui:define name="main"&gt;
    &lt;h:form id="createBookForm"&gt;
      &lt;div&gt;
        &lt;h:outputLabel for="isbn" value="ISBN: "&gt;
        &lt;h:inputText id="isbn" value="#{book.isbn}" 
            <span class="bold"><strong>validator="#{bookCtrl.checkIsbnAsId}"</strong></span> /&gt;
        &lt;/h:outputLabel&gt;
        <span class="bold"><strong>&lt;h:message for="isbn" errorClass="error" /&gt;</strong></span>
      &lt;/div&gt;  
      &lt;div&gt;
        &lt;h:outputLabel for="title" value="Title: "&gt;
        &lt;h:inputText id="title" value="#{book.title}" /&gt;
        &lt;/h:outputLabel&gt;
        <span class="bold"><strong>&lt;h:message for="title" errorClass="error" /&gt;</strong></span>
      &lt;/div&gt;
      ...
    &lt;/h:form&gt;
  &lt;/ui:define&gt;
&lt;/ui:composition&gt;</pre><p>There are only a few changes compared to the same view used for the minimal app, where
    no validation was performed. The first change is the new <code class="code">h:message</code> element which is
    bound to a specific form element by the <code class="code">for</code> attribute. We create such an element
    for each of our form input elements. Notice that we don't have to do anything else for seeing
    the validation errors for all integrity constraint checks which are performed by using the
    (built-in and custom) Bean Validation annotations. As soon as a constraint validation fails, the
    message set by using the <code class="code">message</code> property of the integrity constraint annotation
    (e.g. <code class="code">@Pattern</code>, <code class="code">@NotNull</code>, etc) is displayed in an HTML
     <code class="code">span</code> element generated by JSF as a result of using the <code class="code">h:message</code>
    element.</p><p>For all the integrity constraints we have used Bean Validation annotations, but for the
    uniqueness constraint we have used custom code, therefore no error message will be shown for it.
    In the view code we can see that a new attribute, <code class="code">validator</code> in
     <code class="code">h:inputText</code>, was used for the <code class="code">isbn</code> input field. It specifies which
    custom method is used to perform validation of the provided value in this form field. In our
    case, we use the <code class="code">checkIsbnAsId</code> method defined in the <code class="code">BookController</code> as
    shown
    below:</p><pre class="programlisting">public void <span class="bold"><strong>checkIsbnAsId</strong></span>( FacesContext context, 
    UIComponent component, Object value) 
    throws ValidatorException {
  String isbn = (String) value;
  try {
    Book.checkIsbnAsId( em, isbn);
  } catch ( UniquenessConstraintViolation e) {
    throw new <span class="bold"><strong>ValidatorException</strong></span>( new FacesMessage(
        FacesMessage.SEVERITY_ERROR, e.getMessage(), 
        e.getMessage()));
  } catch ( MandatoryValueConstraintViolation e) {
    throw new ValidatorException( new FacesMessage(
        FacesMessage.SEVERITY_ERROR, e.getMessage(), 
        e.getMessage()));
  }
}</pre><p>The controller's check method throws a
      <code class="code">ValidatorException</code> which is also used to deliver the error
      message (the third parameter of the <code class="code">ValidatorException</code>
      constructor) to the corresponding JSF facelet for being displayed in the
      UI. Methods used as <span class="emphasis"><em>JSF validators</em></span><a class="indexterm" name="d5e6266"></a> must have a specific syntax. The first two parameters of
      type <code class="code">FacesContext</code>, respectively <code class="code">UIComponent</code>
      are used by the container to invoke the method with references to the
      right view component and context, and they can be used in more complex
      validation methods. The last one, of type <code class="code">Object</code>,
      represents the value to be validated by the method. This value has to be
      casted to the expected type (to <code class="code">String</code>, in our example). It
      is important to know that, if a cast to a non-compatible type is
      performed, the validation method fails and an exception is
      thrown.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e6274"></a>5.2.&nbsp;Validation in the <span class="italic">Update </span>use
      case</h3></div></div></div><p>In the <span class="emphasis"><em>Update</em></span> use case, the facelet file
      <code class="filename">update.xhtml</code> in
      <code class="filename">WebContent/views/books</code> was updated so it uses the
      <code class="code">h:message</code> elements for being able to display validation
      errors:</p><pre class="programlisting">&lt;ui:composition template="/WEB-INF/templates/page.xhtml"&gt;
 &lt;ui:define name="headerTitle"&gt;
  &lt;h1&gt;Update a book record&lt;/h1&gt;
 &lt;/ui:define&gt;
 &lt;ui:define name="main"&gt;
  &lt;h:form id="updateBookForm"&gt;
   &lt;div&gt;
    &lt;h:outputLabel for="selectBook" value="Select book: "&gt;
     &lt;h:selectOneMenu id="selectBook" value="#{book.isbn}"&gt;
      ...
     &lt;/h:selectOneMenu&gt;
    &lt;/h:outputLabel&gt;
    &lt;h:message for="selectBook" errorClass="error" /&gt;
   &lt;/div&gt;
   &lt;div&gt;
   <span class="bold"><strong> </strong></span>&lt;h:outputLabel for="isbn" value="ISBN: "&gt;
     &lt;h:<span class="bold"><strong>outputText</strong></span> id="isbn" value="#{<span class="bold"><strong>book.isbn</strong></span>}" /&gt;
    &lt;/h:outputLabel&gt;
   &lt;/div&gt;
   ...
  &lt;/h:form&gt;
 &lt;/ui:define&gt;
&lt;/ui:composition&gt;    </pre><p>Since we do not allow to change the ISBN of a book, we create an
      output field for the <code class="code">isbn</code> attribute with the JSF element
      <code class="code">h:outputText</code>. This implies that no validation is
      performed.</p><p>Using an <code class="code">h:outputText</code> element for showing the value of an entity attribute
    results in an HTML <code class="code">span</code> element. This implies that the HTTP form submission message
    contains no information about that attribute. If the validation fails, we expect to see the form
    content together with the error messages. To get the expected result, we need to use the
    annotation <code class="code">@ViewScoped</code> for the entity class <code class="code">pl.m.Book</code> instead of
     <code class="code">@RequestScoped</code>, otherwise our bean instance referenced by the <code class="code">book</code>
    variable is initialized with a new value on every request, implying that the expression
     <code class="code">#{book.isbn}</code> evaluates to <code class="code">null</code> and the ISBN value is not displayed.
    The <code class="code">@ViewScoped</code> annotation specifies that the entity bean is alive as long as the
    associated view is alive, so the ISBN value stored by the <code class="code">book</code> is available during
    this time and it can be displayed in the view.</p><p>By contrast, <code class="code">h:inputText</code> elements result in HTML
      <code class="code">input</code> elements which are part of the form submission
      content, so the response contains the already existing values because
      these values are known in this case. This consideration shows that it is
      important to choose the right bean scope.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch09s04.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch09.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch09s06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.&nbsp;Write the Model Code&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index-2.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;6.&nbsp;Defining a Custom Validation Annotation</td></tr></table></div></body>
<!-- Mirrored from web-engineering.info/book/WebApp1/ch09s05.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 21 Jul 2023 10:59:57 GMT -->
</html>