<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" vocab="http://schema.org/" typeof="TechArticle WebPage">
<head>
  <meta charset="UTF-8" />
  <title>Plain JavaScript App with Constraint Validation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="A medium-level tutorial about developing a single-class front-end web application with constraint validation using plain JavaScript" />  
  <meta property="learningResourceType" content="Tutorial"/>
  <meta property="proficiencyLevel" content="Beginner"/>
  <meta property="keywords" content="JS web app, JavaScript web app, plain JavaScript web app, pure JavaScript web app, front-end web app, MVC web app, CRUD web app, web app development tutorial, form validation, constraint validation, UML constraint, SQL constraint"/>
  <meta property="isPartOf" content="http://web-engineering.info"/>
  <meta property="specialty" content="http://web-engineering.info/WebAppEngineering.html"/>
  <link rel="stylesheet" type="text/css" href="../docbook.css" />
</head>
<body property="articleBody">
 <aside>
  <nav>
   <ul>
   <li><a href="2-ValidationApp/index.html"><button type="button">Run the app</button></a></li>
   <li><a href="2-ValidationApp.zip"><button type="button">Get the code</button></a></li>
   </ul>
  </nav>
  <div id="supportUs">
   <p>Please support <em>web-engineering.info</em> and buy our e-book <a href="https://gumroad.com/l/YyWka">Building Front-End Web Apps with Plain JavaScript</a>.</p>
   <a href="https://gumroad.com/l/YyWka"><img src="book-cover-new_169x270.jpg" width="169" height="270"/></a>
  </div>
 </aside>
   <div lang="en" class="book"><div class="titlepage"><div><div>
   <h3 class="kicker" style="color:grey"><em>Understanding</em> and <code>Implementing</code> Information Management Concepts and Techniques</h3>
   <h1 class="title"><a name="d5e1"></a>JavaScript Front-End Web App Tutorial Part 2: Adding Constraint Validation</h1></div>
   <div>
   <h2 class="subtitle"><img style="float:right" property="thumbnailUrl" src="2-ValidationApp/favicon.svg" width="120" 
   title="Icon made by Lorc under CC BY 3.0. Available on http://game-icons.net">Learn how to build a front-end web application with responsive constraint validation using plain JavaScript</h2></div>
	<div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Gerd</span> <span class="surname">Wagner</span></h3><code class="email">&lt;<a class="email" href="mailto:G.Wagner@b-tu.de">G.Wagner@b-tu.de</a>&gt;</code></div></div></div><div><p class="releaseinfo">Warning: This tutorial manuscript may contain errors and may still be incomplete.
      Please report any issue to Gerd Wagner at G.Wagner@b-tu.de.</p></div><div><p class="releaseinfo">This tutorial is also available in the following formats: <a class="link" href="validation-tutorial.pdf" target="_top">PDF</a>. You may <a class="link" href="2-ValidationApp/index.html" target="_top">run the example app</a> from our server, or <a class="link" href="2-ValidationApp.zip" target="_top">download the code</a> as a ZIP archive file. See also
      our <a class="link" href="http://web-engineering.info/" target="_top">Web Engineering project
      page</a>.</p></div><div><p class="copyright">Copyright &copy; 2014-2022 Gerd Wagner</p></div><div><div class="legalnotice"><a name="d5e28"></a><p>This tutorial article, along with any associated source code, is licensed under <a class="link" href="http://www.codeproject.com/info/cpol10.aspx" target="_top">The Code Project Open License
          (CPOL)</a>, implying that the associated code is provided "as-is", can be modified to
        create derivative works, can be redistributed, and can be used in commercial applications,
        but the article must not be distributed or republished without the author's consent.</p></div></div><div><p class="pubdate">2022-01-12</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="preface"><a href="#d5e31">Foreword</a></span></dt><dt><span class="chapter"><a href="#chapConstrVal">1. Constraint Validation</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e71">1. Introduction</a></span></dt><dt><span class="section"><a href="#d5e100">2. Integrity Constraints</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e162">2.1. String Length Constraints</a></span></dt><dt><span class="section"><a href="#d5e179">2.2. Mandatory Value Constraints</a></span></dt><dt><span class="section"><a href="#d5e210">2.3. Range Constraints</a></span></dt><dt><span class="section"><a href="#d5e239">2.4. Interval Constraints</a></span></dt><dt><span class="section"><a href="#d5e268">2.5. Pattern Constraints</a></span></dt><dt><span class="section"><a href="#d5e300">2.6. Cardinality Constraints</a></span></dt><dt><span class="section"><a href="#d5e327">2.7. Uniqueness Constraints</a></span></dt><dt><span class="section"><a href="#d5e351">2.8. Standard Identifiers (Primary Keys)</a></span></dt><dt><span class="section"><a href="#d5e374">2.9. Referential Integrity Constraints</a></span></dt><dt><span class="section"><a href="#d5e378">2.10. Frozen and Read-Only Value Constraints</a></span></dt><dt><span class="section"><a href="#d5e403">2.11. Beyond property constraints</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e458">3. Responsive Validation</a></span></dt><dt><span class="section"><a href="#d5e488">4. Constraint Validation in MVC Applications</a></span></dt><dt><span class="section"><a href="#d5e506">5. Adding Constraints to a Design Model</a></span></dt><dt><span class="section"><a href="#d5e589">6. Summary</a></span></dt><dt><span class="section"><a href="#d5e611">7. Quiz Questions</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e613">7.1. Question 1: Where to check constraints</a></span></dt><dt><span class="section"><a href="#d5e622">7.2. Question 2: Where to define constraints</a></span></dt><dt><span class="section"><a href="#d5e633">7.3. Question 3: Counting constraints</a></span></dt><dt><span class="section"><a href="#d5e641">7.4. Question 4: Constraint names</a></span></dt><dt><span class="section"><a href="#d5e665">7.5. Question 5: Compliant objects</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chConstrValJS">2. Constraint Validation in Plain JS</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e685">1. Introduction</a></span></dt><dt><span class="section"><a href="#d5e711">2. New Issues</a></span></dt><dt><span class="section"><a href="#d5e767">3. Using ES6 Modules</a></span></dt><dt><span class="section"><a href="#d5e837">4. Make a JavaScript Class Model</a></span></dt><dt><span class="section"><a href="#d5e891">5. Set up the Folder Structure</a></span></dt><dd><dl><dt><span class="section"><a href="#sectSimpleAppLibFiles">5.1. Provide utility functions and error classes in library
      files</a></span></dt><dt><span class="section"><a href="#sectSimpleAppStartPage">5.2. Create a start page</a></span></dt></dl></dd><dt><span class="section"><a href="#sectSimpleAppModel">6. Write the Model Code</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e956">6.1. Summary</a></span></dt><dt><span class="section"><a href="#d5e976">6.2. Code the model class as a constructor function</a></span></dt><dt><span class="section"><a href="#d5e1026">6.3. Code the property checks</a></span></dt><dt><span class="section"><a href="#d5e1066">6.4. Code the property setters</a></span></dt><dt><span class="section"><a href="#d5e1077">6.5. Add a serialization function</a></span></dt><dt><span class="section"><a href="#d5e1084">6.6. Data management operations</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1156">7. Write the View Code</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e1209">7.1. Set up the user interface for <span class="emphasis"><em>Create
      Book</em></span></a></span></dt><dt><span class="section"><a href="#d5e1261">7.2. Set up the user interface for <span class="emphasis"><em>Update
      Book</em></span></a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1288">8. Possible Variations and Extensions</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e1290">8.1. Adding an object-level validation function</a></span></dt><dt><span class="section"><a href="#d5e1302">8.2. Using implicit JS setters</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1321">9. Points of Attention</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e1323">9.1. Boilerplate code</a></span></dt><dt><span class="section"><a href="#d5e1339">9.2. Configuring the UI for preventing invalid user input</a></span></dt><dt><span class="section"><a href="#d5e1359">9.3. Improving the user experience by showing helpful auto-complete
      suggestions</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1370">10. Quiz Questions</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e1374">10.1. Question 1: Methods to add in JS class model</a></span></dt><dt><span class="section"><a href="#d5e1401">10.2. Question 2: Implementing constraints</a></span></dt><dt><span class="section"><a href="#d5e1423">10.3. Question 3: Implementing setter methods</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1437">11. Practice Project</a></span></dt></dl></dd></dl></div><div class="list-of-figures"><p><b>List of Figures</b></p><dl><dt>1.1. <a href="#figObjLevelConstr">An example of an object-level constraint</a></dt><dt>1.2. <a href="#figBookSimpleAppDesModel">A design model defining the object type <code class="code">Book</code> with
      two invariants</a></dt><dt>2.1. <a href="#figIDM2JsDM">From an information design model to a JS class model</a></dt><dt>2.2. <a href="#figMovieValApp">The object type <code class="code">Movie</code> defined with several
      constraints</a></dt></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>1.1. <a href="#d5e564">Sample data for <code class="code">Book</code></a></dt><dt>2.1. <a href="#d5e989">Datatype mapping</a></dt><dt>2.2. <a href="#d5e1512">Sample data</a></dt></dl></div><div class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="d5e31"></a>Foreword</h1></div></div></div><p>This tutorial is Part 2 of our series of <a class="link" href="http://web-engineering.info/JsFrontendApp" target="_top">six
    tutorials</a> about model-based development of front-end web
    applications with plain JavaScript. It shows how to build a single-class
    front-end web application with constraint validation using plain
    JavaScript, and no third-party framework or library. While libraries and
    frameworks may help to increase productivity, they also create black-box
    dependencies and overhead, and they are not good for learning how to do it
    yourself.</p><p>A front-end web application can be provided by any web server, but
    it is executed on the user's computer device (smartphone, tablet or
    notebook), and not on the remote web server. Typically, but not
    necessarily, a front-end web application is a single-user application,
    which is not shared with other users.</p><p>The <span class="italic">minimal</span> JavaScript app that
    we have discussed in the first part of this 6-part tutorial has been
    limited to support the minimum functionality of a data management app
    only. However, it did not take care of preventing users from entering
    invalid data into the app's database. In this second part of the tutorial
    we show how to express integrity constraints in a JavaScript <span class="italic">model class</span>, and how to perform constraint
    validation both in the model/storage code of the app and in the user
    interface built with HTML5.</p><p>The simple form of a JavaScript data management application
    presented in this tutorial takes care of only one object type ("books")
    for which it supports the four standard data management operations
    (<span class="bold"><strong>C</strong></span>reate/<span class="bold"><strong>R</strong></span>etrieve/<span class="bold"><strong>U</strong></span>pdate/<span class="bold"><strong>D</strong></span>elete). It
    extends the minimal app discussed in the <a class="link" href="minimal-tutorial.html" target="_top">Minimal App Tutorial</a> by adding
    <span class="italic"><span class="bold"><strong>constraint
    validation</strong></span></span> (and some CSS styling), but it needs to
    be enhanced by adding further important parts of the app's overall
    functionality. The other parts of the tutorial are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="minimal-tutorial.html" target="_top">Part 1</a>: Building
        a <span class="bold"><strong>minimal</strong></span> app.</p></li><li class="listitem"><p><a class="link" href="enumeration-tutorial.html" target="_top">Part 3</a>:
        Dealing with <span class="bold"><strong>enumerations</strong></span>.</p></li><li class="listitem"><p><a class="link" href="unidirectional-association-tutorial.html" target="_top">Part
        4</a>: Managing <span class="bold"><strong>unidirectional
        associations</strong></span>, such as the associations between books and
        publishers, assigning a publisher to a book, and between books and
        authors, assigning authors to a book.</p></li><li class="listitem"><p><a class="link" href="bidirectional-association-tutorial.html" target="_top">Part
        5</a>: Managing <span class="bold"><strong>bidirectional
        associations</strong></span>, such as the associations between books and
        publishers and between books and authors, also assigning books to
        authors and to publishers.</p></li><li class="listitem"><p><a class="link" href="subtyping-tutorial.html" target="_top">Part 6</a>:
        Handling <span class="bold"><strong>subtype</strong></span> (inheritance)
        relationships between object types.</p></li></ul></div></div><div lang="en-US" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chapConstrVal"></a>Chapter&nbsp;1.&nbsp;Integrity Constraints and Data Validation</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#d5e71">1. Introduction</a></span></dt><dt><span class="section"><a href="#d5e100">2. Integrity Constraints</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e162">2.1. String Length Constraints</a></span></dt><dt><span class="section"><a href="#d5e179">2.2. Mandatory Value Constraints</a></span></dt><dt><span class="section"><a href="#d5e210">2.3. Range Constraints</a></span></dt><dt><span class="section"><a href="#d5e239">2.4. Interval Constraints</a></span></dt><dt><span class="section"><a href="#d5e268">2.5. Pattern Constraints</a></span></dt><dt><span class="section"><a href="#d5e300">2.6. Cardinality Constraints</a></span></dt><dt><span class="section"><a href="#d5e327">2.7. Uniqueness Constraints</a></span></dt><dt><span class="section"><a href="#d5e351">2.8. Standard Identifiers (Primary Keys)</a></span></dt><dt><span class="section"><a href="#d5e374">2.9. Referential Integrity Constraints</a></span></dt><dt><span class="section"><a href="#d5e378">2.10. Frozen and Read-Only Value Constraints</a></span></dt><dt><span class="section"><a href="#d5e403">2.11. Beyond property constraints</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e458">3. Responsive Validation</a></span></dt><dt><span class="section"><a href="#d5e488">4. Constraint Validation in MVC Applications</a></span></dt><dt><span class="section"><a href="#d5e506">5. Adding Constraints to a Design Model</a></span></dt><dt><span class="section"><a href="#d5e589">6. Summary</a></span></dt><dt><span class="section"><a href="#d5e611">7. Quiz Questions</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e613">7.1. Question 1: Where to check constraints</a></span></dt><dt><span class="section"><a href="#d5e622">7.2. Question 2: Where to define constraints</a></span></dt><dt><span class="section"><a href="#d5e633">7.3. Question 3: Counting constraints</a></span></dt><dt><span class="section"><a href="#d5e641">7.4. Question 4: Constraint names</a></span></dt><dt><span class="section"><a href="#d5e665">7.5. Question 5: Compliant objects</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e71"></a>1.&nbsp;Introduction</h2></div></div></div><p>For detecting non-admissible and inconsistent data and for
    preventing such data to be added to an application's database, we need to
    define suitable <span class="bold"><strong><span class="italic">integrity
    constraints</span></strong></span><a class="indexterm" name="d5e76"></a> that can be used by the application's <span class="bold"><strong><span class="italic">data validation</span></strong></span>
    mechanisms for catching these cases of flawed data. Integrity constraints
    are logical conditions that must be satisfied by the data entered by a
    user and stored in the application's database.</p><p>For instance, if an application is managing data about persons
    including their birth dates and their death dates, then we must make sure
    that for any person record with a death date, this date is not before that
    person's birth date.</p><p>Since <span class="italic">integrity maintenance</span> is
    fundamental in database management, the <span class="italic">data
    definition language</span> part of the <span class="italic">relational database language SQL</span><a class="indexterm" name="d5e85"></a> supports the definition of integrity constraints in various
    forms. On the other hand, however, there is hardly any support for
    integrity constraints and data validation in common programming languages
    such as PHP, Java, C# or JavaScript. It is therefore important to take a
    systematic approach to constraint validation in web application
    engineering, like choosing an application development framework that
    provides sufficient support for it.</p><p>Unfortunately, many web application development frameworks do not
    provide sufficient support for defining integrity constraints and
    performing data validation. Integrity constraints should be defined in one
    (central) place in an app, and then be used for configuring the user
    interface and for validating data in different parts of the app, such as
    in the user interface and in the database. In terms of usability, the
    goals should be:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>To prevent the user from entering invalid data in the user
          interface (UI) by limiting the input options, if possible.</p></li><li class="listitem"><p>To detect and reject invalid user input as early as possible
          by performing constraint validation in the UI for those UI widgets
          where invalid user input cannot be prevented by limiting the input
          options.</p></li><li class="listitem"><p>To prevent that invalid data pollutes the app's main memory
          state and persistent database state by performing constraint
          validation also in the model layer and in the database.</p></li></ol></div><p>HTML5 provides support for validating user input in an
    HTML-forms-based user interface (UI). Here, the goal is to provide
    immediate feedback to the user whenever invalid data has been entered into
    a form field. This UI mechanism of <span class="italic"><span class="bold"><strong>responsive validation</strong></span></span><a class="indexterm" name="d5e98"></a> is an important feature of modern web applications. In
    traditional web applications, the back-end component validates the data
    and returns the validation results in the form of a set of error messages
    to the front-end. Only then, often several seconds later, and in the
    hard-to-digest form of a bulk message, does the user get the validation
    feedback.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e100"></a>2.&nbsp;Integrity Constraints</h2></div></div></div><p>Integrity constraints (or simply <span class="italic">constraints</span>) are logical conditions on the data
    of an app. They may take many different forms. The most important type of
    constraints, <span class="bold"><strong><span class="italic">property
    constraints</span></strong></span>, define conditions on the admissible
    property values of an object. They are defined for an object type (or
    class) such that they apply to all objects of that type. We concentrate on
    the most important cases of property constraints: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">String Length Constraints</span></dt><dd><p>require that the length of a string value for an attribute
            is less than a certain maximum number, or greater than a minimum
            number.</p></dd><dt><span class="term">Mandatory Value Constraints</span></dt><dd><p>require that a property must have a value. For instance, a
            person must have a name, so the name attribute must not be
            empty.</p></dd><dt><span class="term">Range Constraints</span></dt><dd><p>require that an attribute must have a value from the value
            space of the type that has been defined as its range. For
            instance, an integer attribute must not have the value
            "aaa".</p></dd><dt><span class="term">Interval Constraints</span></dt><dd><p>require that the value of a numeric attribute must be in a
            specific interval.</p></dd><dt><span class="term">Pattern Constraints</span></dt><dd><p>require that a string attribute's value must match a certain
            pattern defined by a regular expression.</p></dd><dt><span class="term">Cardinality Constraints</span></dt><dd><p>apply to multi-valued properties, only, and require that the
            cardinality of a multi-valued property's value set is not less
            than a given minimum cardinality or not greater than a given
            maximum cardinality.</p></dd><dt><span class="term">Uniqueness Constraints (also called 'Key Constraints')</span></dt><dd><p>require that a property's value is unique among all
            instances of the given object type.</p></dd><dt><span class="term">Referential Integrity Constraints</span></dt><dd><p>require that the values of a reference property refer to an
            existing object in the range of the reference property.</p></dd><dt><span class="term">Frozen Value Constraints</span></dt><dd><p>require that the value of a property must not be changed
            after it has been assigned initially.</p></dd></dl></div><p>The visual language of UML class diagrams supports defining
    integrity constraints either in a special way for special cases (like with
    predefined keywords), or, in the general case, with the help of <span class="italic">invariants</span>, which are conditions expressed either
    in plain English or in the <span class="emphasis"><em>Object Constraint Language
    (OCL)</em></span> and shown in a special type of rectangle attached to the
    model element concerned. We use UML class diagrams for modeling
    constraints in <span class="italic">design models</span> that are
    independent of a specific programming language or technology
    platform.</p><p>UML class diagrams provide special support for expressing
    multiplicity (or cardinality) constraints. This type of constraint allows
    to specify a lower multiplicity (minimum cardinality) or an upper
    multiplicity (maximum cardinality), or both, for a property or an
    association end. In UML, this takes the form of a multiplicity expression
    <code class="code">l..u</code> where the lower multiplicity <code class="code">l</code> is a
    non-negative integer and the upper multiplicity <code class="code">u</code> is either a
    positive integer not smaller than <code class="code">l</code> or the special value
    <code class="code">*</code> standing for <span class="italic">unbounded</span>.
    For showing property multiplicity (or cardinality) constrains in a class
    diagram, multiplicity expressions are enclosed in brackets and appended to
    the property name, as shown in the <code class="code">Person</code> class rectangle
    below.</p><p>In the following sections, we discuss the different types of
    property constraints listed above in more detail. We also show how to
    express some of them in computational languages such as <span class="italic">UML</span> class diagrams, <span class="italic">SQL</span> table creation statements, <span class="italic">JavaScript</span> model class definitions, or the
    annotation-based languages <span class="italic">Java Bean
    Validation</span> annotations and <span class="italic">ASP.NET Data
    Annotations</span>.</p><p>Any systematic approach to constraint validation also requires to
    define a set of error (or 'exception') classes, including one for each of
    the standard property constraints listed above.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e162"></a>2.1.&nbsp;String Length Constraints</h3></div></div></div><p>The length of a string value for a property such as the title of a
      book may have to be constrained, typically rather by a maximum length,
      but possibly also by a minimum length. In an SQL table definition, a
      maximum string length can be specified in parenthesis appended to the
      SQL datatype <code class="code">CHAR</code> or <code class="code">VARCHAR</code>, as in
      <code class="code">VARCHAR(50)</code>.</p><p>UML does not define any special way of expressing string length
      constraints in class diagrams. Of course, we always have the option to
      use an <span class="italic">invariant</span> for expressing any
      kind of constraint, but it seems preferable to use a simpler form of
      expressing these property constraints. One option is to append a maximum
      length, or both a minimum and a maximum length, in parenthesis to the
      datatype name, like so </p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="180"><tr><td><img src="../fig/Book_withStringLengthConstraint_1.svg" width="180"></td></tr></table></div></div><p>Another option is to use min/max constraint keywords in the
      property modifier list:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="240"><tr><td><img src="../fig/Book_withStringLengthConstraint_2.svg" width="240"></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e179"></a>2.2.&nbsp;Mandatory Value Constraints</h3></div></div></div><p>A <span class="italic">mandatory value constraint</span>
      requires that a property must have a value. This can be expressed in a
      UML class diagram with the help of a multiplicity constraint expression
      where the lower multiplicity is 1. For a single-valued property, this
      would result in the multiplicity expression <code class="code">1..1</code>, or the
      simplified expression <code class="code">1</code>, appended to the property name in
      brackets. For example, the following class diagram defines a mandatory
      value constraint for the property <code class="code">name</code>: </p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="180"><tr><td><img src="../fig/Person_ExampleModel.svg" width="180"></td></tr></table></div></div><p>Whenever a class rectangle does not show a multiplicity expression
      for a property, the property is mandatory (and single-valued), that is,
      the multiplicity expression <code class="code">1</code> is the default for
      properties.</p><p>In an SQL table creation statement, a mandatory value constraint
      is expressed in a table column definition by appending the key phrase
      <code class="code">NOT NULL</code> to the column definition as in the following
      example: </p><pre class="programlisting">CREATE TABLE persons(
  name  VARCHAR(30) <span class="bold"><strong>NOT NULL</strong></span>,
  age   INTEGER
)</pre><p>According to this table definition, any row of the
      <code class="code">persons</code> table must have a value in the column
      <code class="code">name</code>, but not necessarily in the column
      <code class="code">age</code>.</p><p>In JavaScript, we can code a mandatory value constraint by a
      class-level check function that tests if the provided argument evaluates
      to a value, as illustrated in the following example:</p><pre class="programlisting">Person.checkName = function (n) {
  if (n === undefined) {
    return "A name must be provided!"; // constraint violation error message
  } else return "";  // no constraint violation
};</pre><p>With Java Bean Validation, a mandatory property like
      <code class="code">name</code> is annotated with <code class="code">NotNull</code> in the
      following way:</p><pre class="programlisting">@Entity
public class Person {
  <span class="bold"><strong>@NotNull</strong></span>
  private String name;
  private int age;
}</pre><p>The equivalent ASP.NET Data Annotation is <code class="code">Required</code> as
      shown in</p><pre class="programlisting">public class Person{
  [<span class="bold"><strong>Required</strong></span>]
  public string name { get; set; }
  public int age { get; set; }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e210"></a>2.3.&nbsp;Range Constraints</h3></div></div></div><p>A range constraint requires that a property must have a value from
      the value space of the type that has been defined as its range. This is
      implicitly expressed by defining a type for a property as its range. For
      instance, the attribute <code class="code">age</code> defined for the object type
      <code class="code">Person</code> in the class diagram above has the range
      <code class="code">Integer</code>, so it must not have a value like "aaa", which does
      not denote an integer. However, it may have values like -13 or 321,
      which also do not make sense as the age of a person. In a similar way,
      since its range is <code class="code">String</code>, the attribute <code class="code">name</code>
      may have the value "" (the empty string), which is a valid string that
      does not make sense as a name.</p><p>We can avoid allowing negative integers like -13 as age values,
      and the empty string as a name, by assigning more specific datatypes as
      range to these attributes, such as <code class="code">NonNegativeInteger</code> to
      <code class="code">age</code>, and <code class="code">NonEmptyString</code> to <code class="code">name</code>.
      Notice that such more specific datatypes are neither predefined in SQL
      nor in common programming languages, so we have to implement them either
      in the form of user-defined types, as supported in SQL-99 database
      management systems such as PostgreSQL, or by using suitable additional
      constraints such as <span class="italic">interval
      constraints</span>, which are discussed in the next section. In a
      UML class diagram, we can simply define <code class="code">NonNegativeInteger</code>
      and <code class="code">NonEmptyString</code> as custom datatypes and then use them in
      the definition of a property, as illustrated in the following diagram:
      </p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="250"><tr><td><img src="../fig/Person_ExampleModelWithCustomPropertyRange.svg" width="250"></td></tr></table></div></div><p>In JavaScript, we can code a range constraint by a check function,
      as illustrated in the following example:</p><pre class="programlisting">Person.checkName = function (n) {
  if (typeof(n) !== "string" || n.trim() === "") {
    return "Name must be a non-empty string!";
  } else return "";
};</pre><p>This check function detects and reports a constraint
      violation if the given value for the <code class="code">name</code> property is not
      of type "string" or is an empty string.</p><p>In a Java EE web app, for declaring empty strings as
      non-admissible user input we must set the context parameter</p><pre class="programlisting">javax.faces.INTERPRET_EMPTY_STRING_SUBMITTED_VALUES_AS_NULL </pre><p>to <code class="code">true</code> in the web deployment descriptor file
      <code class="code">web.xml</code>.</p><p>In ASP.NET, empty strings are non-admissible by default.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e239"></a>2.4.&nbsp;Interval Constraints</h3></div></div></div><p>An interval constraint requires that an attribute's value must be
      in a specific interval, which is specified by a minimum value or a
      maximum value, or both. Such a constraint can be defined for any
      attribute having an ordered type, but normally we define them only for
      numeric datatypes or calendar datatypes. For instance, we may want to
      define an interval constraint requiring that the <code class="code">age</code>
      attribute value must be in the interval [25,70]. In a class diagram, we
      can define such a constraint by using the property modifiers
      <code class="code">min</code> and <code class="code">max</code>, as shown for the <code class="code">age</code>
      attribute of the <code class="code">Driver</code> class in the following
      diagram.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="250"><tr><td><img src="../fig/Driver_ExampleModelWithIntervalConstraint.svg" width="250"></td></tr></table></div></div><p>In an SQL table creation statement, an interval constraint is
      expressed in a table column definition by appending a suitable
      <code class="code">CHECK</code> clause to the column definition as in the following
      example: </p><pre class="programlisting">CREATE TABLE drivers(
  name  VARCHAR NOT NULL,
  age   INTEGER <span class="bold"><strong>CHECK (age &gt;= 25 AND age &lt;= 70)</strong></span>
)</pre><p>In JavaScript, we can code an interval constraint in the following
      way:</p><pre class="programlisting">Driver.checkAge = function (a) {
  if (a &lt; 25 || a &gt; 70) {
    return "Age must be between 25 and 70!";
  } else return "";
};</pre><p>In Java Bean Validation, we express this interval constraint by
      adding the annotations <code class="code">Min(0)</code> and <code class="code">Max(120)</code> to
      the property <code class="code">age</code> in the following way:</p><pre class="programlisting">@Entity
public class Driver {
  @NotNull
  private String name;
  <span class="bold"><strong>@Min(25) </strong></span><span class="bold"><strong>@Max(70)</strong></span>
  private int age;
} </pre><p>The equivalent ASP.NET Data Annotation is
      <code class="code">Range(25,70)</code> as shown in</p><pre class="programlisting">public class Driver{
  [Required]
  public string name { get; set; }
  [<span class="bold"><strong>Range(25,70)</strong></span>]
  public int age { get; set; }
} </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e268"></a>2.5.&nbsp;Pattern Constraints</h3></div></div></div><p>A pattern constraint requires that a string attribute's value must
      match a certain pattern, typically defined by a <span class="italic">regular expression</span>. For instance, for the
      object type <code class="code">Book</code> we define an <code class="code">isbn</code> attribute
      with the datatype <code class="code">String</code> as its range and add a pattern
      constraint requiring that the <code class="code">isbn</code> attribute value must be
      a 10-digit string or a 9-digit string followed by "X" to the
      <code class="code">Book</code> class rectangle shown in the following diagram.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="350"><tr><td><img src="../fig/Book_ExampleModelWithPatternConstraint.svg" width="350"></td></tr></table></div></div><p>In an SQL table creation statement, a pattern constraint is
      expressed in a table column definition by appending a suitable
      <code class="code">CHECK</code> clause to the column definition as in the following
      example: </p><pre class="programlisting">CREATE TABLE books(
  isbn   VARCHAR(10) NOT NULL <span class="bold"><strong>CHECK (isbn ~ '^\d{9}(\d|X)$')</strong></span>,
  title  VARCHAR(50) NOT NULL
)</pre><p>The <code class="code">~</code> (tilde) symbol denotes the regular
      expression matching predicate and the regular expression
      <code class="code">^\d{9}(\d|X)$</code> follows the syntax of the POSIX standard
      (see, e.g. the <a class="link" href="http://www.postgresql.org/docs/9.0/static/functions-matching.html" target="_top">PostgreSQL
      documentation</a>).</p><p>In JavaScript, we can code a pattern constraint by using the
      built-in regular expression function <code class="code">test</code>, as illustrated
      in the following example:</p><pre class="programlisting">Person.checkIsbn = function (id) {
  if (!/\b\d{9}(\d|X)\b/.test( id)) {
    return "The ISBN must be a 10-digit string or a 9-digit string followed by 'X'!";
  } else return "";
};</pre><p>In Java EE Bean Validation, this pattern constraint for
      <code class="code">isbn</code> is expressed with the annotation <code class="code">Pattern</code>
      in the following way:</p><pre class="programlisting">@Entity
public class Book {
  @NotNull
  @<span class="bold"><strong>Pattern(regexp="^\\(\d{9}(\d|X))$")</strong></span>
  private String isbn;
  @NotNull
  private String title;
} </pre><p>The equivalent ASP.NET Data Annotation is
      <code class="code">RegularExpression</code> as shown in</p><pre class="programlisting">public class Book{
  [Required]
  [<span class="bold"><strong>RegularExpression(@"^(\d{9}(\d|X))$")</strong></span>]
  public string isbn { get; set; }
  public string title { get; set; }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e300"></a>2.6.&nbsp;Cardinality Constraints</h3></div></div></div><p>A cardinality constraint requires that the cardinality of a
      multi-valued property's value set is not less than a given <span class="bold"><strong><span class="italic">minimum
      cardinality</span></strong></span> or not greater than a given <span class="bold"><strong><span class="italic">maximum
      cardinality</span></strong></span>. In UML, cardinality constraints are
      called <span class="bold"><strong><span class="italic">multiplicity
      constraints</span></strong></span>, and minimum and maximum cardinalities
      are expressed with the lower bound and the upper bound of the
      multiplicity expression, as shown in the following diagram, which
      contains two examples of properties with cardinality constraints.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="350"><tr><td><img src="../fig/CardinalityConstraintsExamples.svg" width="350"></td></tr></table></div></div><p>The attribute definition <code class="code">nickNames[0..3]</code> in the class
      <code class="code">Person</code> specifies a minimum cardinality of 0 and a maximum
      cardinality of 3, with the meaning that a person may have no nickname or
      at most 3 nicknames. The reference property definition
      <code class="code">members[3..5]</code> in the class <code class="code">Team</code> specifies a
      minimum cardinality of 3 and a maximum cardinality of 5, with the
      meaning that a team must have at least 3 and at most 5 members.</p><p>It's not obvious how cardinality constraints could be checked in
      an SQL database, as there is no explicit concept of cardinality
      constraints in SQL, and the generic form of constraint expressions in
      SQL, assertions, are not supported by available DBMSs. However, it seems
      that the best way to implement a minimum (or maximum) cardinality
      constraint is an on-delete (or on-insert) trigger that tests the number
      of rows with the same reference as the deleted (or inserted) row.</p><p>In JavaScript, we can code a cardinality constraint validation for
      a multi-valued property by testing the size of the property's value set,
      as illustrated in the following example:</p><pre class="programlisting">Person.checkNickNames = function (nickNames) {
  if (nickNames.length &gt; 3) {
    return "There must be no more than 3 nicknames!";
  } else return "";
};</pre><p>With Java Bean Validation annotations, we can specify</p><pre class="programlisting"><span class="bold"><strong>@Size( max=3)</strong></span> 
List&lt;String&gt; <span class="bold"><strong>nickNames</strong></span>
<span class="bold"><strong>@Size( min=3, max=5)</strong></span> 
List&lt;Person&gt; <span class="bold"><strong>members</strong></span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e327"></a>2.7.&nbsp;Uniqueness Constraints</h3></div></div></div><p>A <span class="italic">uniqueness constraint</span> (or
      <span class="italic">key<a class="indexterm" name="d5e332"></a> constraint</span>) requires that a property's value
      (or the value list of a list of properties in the case of a composite
      key constraint) is unique among all instances of the given object type.
      For instance, in a UML class diagram with the object type
      <code class="code">Book</code> we can define the <code class="code">isbn</code> attribute to be
      <span class="emphasis"><em>unique</em></span>, or, in other words, a
      <span class="emphasis"><em>key</em></span>, by appending the (user-defined) property
      modifier keyword <code class="code">key</code> in curly braces to the attribute's
      definition in the <code class="code">Book</code> class rectangle shown in the
      following diagram.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="160"><tr><td><img src="../fig/Book_ExampleModelWithUniquenessConstraint.svg" width="160"></td></tr></table></div></div><p>In an SQL table creation statement, a uniqueness constraint is
      expressed by appending the keyword <code class="code">UNIQUE</code> to the column
      definition as in the following example: </p><pre class="programlisting">CREATE TABLE books(
  isbn   VARCHAR(10) NOT NULL <span class="bold"><strong>UNIQUE</strong></span>,
  title  VARCHAR(50) NOT NULL
)</pre><p>In JavaScript, we can code this uniqueness constraint by a check
      function that tests if there is already a book with the given
      <code class="code">isbn</code> value in the <code class="code">books</code> table of the app's
      database.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e351"></a>2.8.&nbsp;Standard Identifiers (Primary Keys)</h3></div></div></div><p>A unique attribute (or a composite key) can be declared to be the
      standard identifier for objects of a given type, if it is mandatory (or
      if all attributes of the composite key are mandatory). We can indicate
      this in a UML class diagram with the help of the property modifier
      <code class="code">id</code> appended to the declaration of the attribute
      <code class="code">isbn</code> as shown in the following diagram.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="150"><tr><td><img src="../fig/Book_ExampleModelWithStandardIdentifier.svg" width="150"></td></tr></table></div></div><p>Notice that such a standard ID declaration implies both a
      mandatory value and a uniqueness constraint on the attribute
      concerned.</p><p>Often, practitioners do not recommended using a composite key as a
      standard ID, since composite identifiers are more difficult to handle
      and not always supported by tools. Whenever an object type does not have
      a key attribute, but only a composite key, it may therefore be
      preferable to add an artificial standard ID attribute (also called
      <span class="italic">surrogate ID</span>) to the object type.
      However, each additional surrogate ID has a price: it creates some
      cognitive and computational overhead. Consequently, in the case of a
      simple composite key, it may be preferable not to add a surrogate ID,
      but use the composite key as the standard ID.</p><p>There is also an argument against using any real attribute, such
      as the <code class="code">isbn</code> attribute, for a standard ID. The argument
      points to the risk that the values even of natural ID attributes like
      <code class="code">isbn</code> may have to be changed during the life time of a
      business object, and any such change would require an unmanageable
      effort to change also all corresponding ID references. However, the
      business semantics of natural ID attributes implies that they are
      frozen. Thus, the need of a value change can only occur in the case of a
      data input error. But such a case is normally detected early in the life
      time of the object concerned, and at this stage the change of all
      corresponding ID references is still manageable.</p><p>Standard IDs are called <span class="italic">primary
      keys<a class="indexterm" name="d5e368"></a></span> in relational databases. We can declare an
      attribute to be the primary key in an SQL table creation statement by
      appending the phrase <code class="code">PRIMARY KEY</code> to the column definition
      as in the following example: </p><pre class="programlisting">CREATE TABLE books(
  isbn   VARCHAR(10) <span class="bold"><strong>PRIMARY KEY</strong></span>,
  title  VARCHAR(50) NOT NULL
)</pre><p>In object-oriented programming languages, like JavaScript and
      Java, we cannot code a standard ID declaration, because this would have
      to be part of the metadata of a class definition, and there is no
      support for such metadata. However, we should still check the implied
      mandatory value and uniqueness constraints.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e374"></a>2.9.&nbsp;Referential Integrity Constraints</h3></div></div></div><p>A referential integrity constraint requires that the values of a
      reference property refer to an object that exists in the population of
      the property's range class. Since we do not deal with reference
      properties in this chapter, we postpone the discussion of referential
      integrity constraints to 
       <span class="phrase">Part
      4 of our tutorial.</span></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e378"></a>2.10.&nbsp;Frozen and Read-Only Value Constraints</h3></div></div></div><p>A frozen value constraint defined for a property requires that the
      value of this property must not be changed after it has been assigned.
      This includes the special case of <span class="bold"><strong><span class="italic">read-only value constraints</span></strong></span> on
      mandatory properties that are initialized at object creation
      time.</p><p>Typical examples of properties with a frozen value constraint are
      standard identifier attributes and event properties. In the case of
      events, the semantic principle that the past cannot be changed prohibits
      that the property values of events can be changed. In the case of a
      standard identifier attribute we may want to prevent users from changing
      the ID of an object since this requires that all references to this
      object using the old ID value are changed as well, which may be
      difficult to achieve (even though SQL provides special support for such
      ID changes by means of its <code class="code">ON UPDATE CASCADE</code> clause for the
      change management of foreign keys).</p><p>The following diagram shows how to define a frozen value
      constraint for the <code class="code">isbn</code> attribute:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="200"><tr><td><img src="../fig/Book_ExampleModelWithFrozenValConstr.svg" width="200"></td></tr></table></div></div><p>In Java, a <span class="italic">read-only</span> value
      constraint can be enforced by declaring the property to be
      <code class="code">final</code>. In JavaScript, a <span class="italic">read-only</span> property slot can be implemented as
      in the following example:</p><pre class="programlisting">Object.defineProperty( obj, "teamSize", {value: 5, <span class="bold"><strong>writable: false</strong></span>, enumerable: true})</pre><p>where the property slot <code class="code">obj.teamSize</code> is made
      unwritable. An entire object <code class="code">obj</code> can be frozen with
      <code class="code">Object.freeze( obj)</code>.</p><p>We can implement a frozen value constraint for a property in the
      property's setter method like so:</p><pre class="programlisting">Book.prototype.setIsbn = function (i) {
  if (this.isbn === undefined) this.isbn = i;
  else console.log("Attempt to re-assign a frozen property!");
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e403"></a>2.11.&nbsp;Beyond property constraints</h3></div></div></div><p>So far, we have only discussed how to define and check <span class="italic">property constraints</span>. However, in certain cases
      there may be also integrity constraints that do not just depend on the
      value of a particular property, but rather on </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>the values of several properties of a particular object
            (object-level constraints),</p></li><li class="listitem"><p>the value of a property before and its value after a change
            attempt (dynamic constraints),</p></li><li class="listitem"><p>the set of all instances of a particular object type
            (type-level constraints),</p></li><li class="listitem"><p>the set of all instances of several object types.</p></li></ol></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>OCL</b></p></div></div></div><p>The <span class="italic">Object Constraint
        Language</span><a class="indexterm" name="d5e420"></a> (OCL<a class="indexterm" name="d5e422"></a>) was defined in 1997 as a formal logic language for
        expressing integrity constraints in UML version 1.1. Later, it was
        extended for allowing to define also (1) derivation expressions for
        defining derived properties, and (2) preconditions and postconditions
        for operations, in a class model.</p></div><p>In a class model, property constraints can be expressed within the
      property declaration line in a class rectangle (typically with keywords,
      such as <code class="code">id</code>, <code class="code">max</code>, etc.). For expressing more
      complex constraints, such as object-level or type-level constraints, we
      can attach an <span class="emphasis"><em>invariant</em></span> declaration box to the
      class rectangle(s) concerned and express the constraint in unambiguous
      plain English or in <span class="phrase">pseudo-code</span>
      . A simple example of an
      object-level constraint expressed as an invariant is shown in <a class="xref" href="#figObjLevelConstr" title="Figure&nbsp;1.1.&nbsp;An example of an object-level constraint">Figure&nbsp;1.1</a>.</p><div class="figure"><a name="figObjLevelConstr"></a><p class="title"><b>Figure&nbsp;1.1.&nbsp;An example of an object-level constraint</b></p><div class="figure-contents"><div class="mediaobject"><img src="../fig/AuthorConstraints.svg" alt="An example of an object-level constraint"></div></div></div><br class="figure-break"><p>A general approach for implementing <span class="emphasis"><em>object-level
      constraint validation</em></span> consists of taking the following
      steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Choose a fixed name for an object-level constraint validation
          function, such as <code class="code">validate</code>.</p></li><li class="listitem"><p>For any class that needs object-level constraint validation,
          define a <code class="code">validate</code> function returning either a
          <code class="code">ConstraintViolation</code> or a
          <code class="code">NoConstraintViolation</code> object.</p></li><li class="listitem"><p>Call this function, if it exists, for the given model
          class,</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>in the UI/view, on form submission;</p></li><li class="listitem"><p>in the model class, before save, both in the
              <code class="code">create</code> and in the <code class="code">update</code>
              method.</p></li></ol></div></li></ol></div><p>Constraints affecting two or more model classes could be defined
      in the form of static methods (in a model layer method library) that are
      invoked from the <code class="code">validate</code> methods of the affected model
      classes.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e458"></a>3.&nbsp;Responsive Validation</h2></div></div></div><p>This problem is well-known from classical web applications where the
    front-end component submits the user input data via HTML form submission
    to a back-end component running on a remote web server. Only this back-end
    component validates the data and returns the validation results in the
    form of a set of error messages to the front-end. Only then, often several
    seconds later, and in the hard-to-digest form of a bulk message, does the
    user get the validation feedback. This approach is no longer considered
    acceptable today. Rather, in a <span class="italic">responsive
    validation</span> approach, the user should get immediate validation
    feedback on each single data input. Technically, this can be achieved with
    the help of event handlers for the user interface events
    <code class="code">input</code> or <code class="code">change</code>.</p><p>Responsive validation requires a data validation mechanism in the
    user interface (UI), such as the <a class="link" href="http://www.html5rocks.com/en/tutorials/forms/constraintvalidation/" target="_top">HTML5
    form validation API</a>. Alternatively, the <a class="link" href="http://jqueryvalidation.org/" target="_top">jQuery Validation Plugin</a>
    can be used as a (non-HTML5-based) form validation API.</p><p>The HTML5 form validation API<a class="indexterm" name="d5e468"></a> essentially provides new types of <code class="code">input</code> fields
    (such as <code class="code">number</code> or <code class="code">date</code>) and a set of new
    attributes for form control elements for the purpose of supporting
    responsive validation performed by the browser. Since using the new
    validation attributes (like <code class="code">required</code>, <code class="code">min</code>,
    <code class="code">max</code> and <code class="code">pattern</code>) implies defining constraints in
    the UI, they are not really useful in a general approach where constraints
    are only checked, but not defined, in the UI.</p><p>Consequently, we only use two methods of the HTML5 form validation
    API for validating constraints in the HTML-forms-based user interface of
    our app. The first of them, <code class="code">setCustomValidity</code>, allows to mark
    a form field as either valid or invalid by assigning either an empty
    string or a non-empty (constraint violation) message string.</p><p>The second method, <code class="code">checkValidity</code>, is invoked on a form
    before user input data is committed or saved (for instance with a form
    submission). It tests, if all fields have a valid value. For having the
    browser automatically displaying any constraint violation messages, we
    need to have a <code class="code">submit</code> event, even if we don't really submit
    the form, but just use a <code class="code">save</code> button.</p><p>See this <a class="link" href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5/Constraint_validation" target="_top">Mozilla
    tutorial</a> or this <a class="link" href="http://www.html5rocks.com/en/tutorials/forms/constraintvalidation/" target="_top">HTML5Rocks
    tutorial</a> for more about the HTML5 form validation API.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e488"></a>4.&nbsp;Constraint Validation in MVC Applications</h2></div></div></div><p>Integrity constraints should be defined in the model classes of an
    MVC app since they are part of the business semantics of a model class
    (representing a business object type). However, a more difficult question
    is where to perform data validation? In the database? In the model
    classes? In the controller? Or in the user interface ("view")? Or in all
    of them?</p><p>A relational database management system (DBMS) performs data
    validation whenever there is an attempt to change data in the database,
    provided that all relevant integrity constraints have been defined in the
    database. This is essential since we want to avoid, under all
    circumstances, that invalid data enters the database. However, it requires
    that we somehow duplicate the code of each integrity constraint, because
    we want to have it also in the model class to which the constraint
    belongs.</p><p>Also, if the DBMS would be the only application component that
    validates the data, this would create a latency, and hence usability,
    problem in distributed applications because the user would not get
    immediate feedback on invalid input data. Consequently, data validation
    needs to start in the user interface (UI).</p><p>However, it is not sufficient to perform data validation in the UI.
    We also need to do it in the model classes, and in the database, for
    making sure that no flawed data enters the application's persistent data
    store. This creates the problem of how to maintain the constraint
    definitions in one place (the model), but use them in two or three other
    places (at least in the model classes and in the UI code, and possibly
    also in the database). We call this the <span class="bold"><strong><span class="italic">multiple validation problem</span></strong></span>. This
    problem can be solved in different ways. For instance:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Define the constraints in a declarative language (such as
        <span class="italic">Java Bean Validation Annotations</span> or
        <span class="italic">ASP.NET Data Annotations</span>) and
        generate the back-end/model and front-end/UI validation code both in a
        back-end application programming language such as Java or C#, and in
        JavaScript.</p></li><li class="listitem"><p>Keep your validation functions in the (PHP, Java, C# etc.) model
        classes on the back-end, and invoke them from the JavaScript UI code
        via XHR. This approach can only be used for specific validations,
        since it implies the penalty of an additional HTTP communication
        latency for each validation invoked in this way.</p></li><li class="listitem"><p>Use JavaScript as your back-end application programming language
        (such as with NodeJS), then you can code your validation functions in
        your JavaScript model classes on the back-end and execute them both
        before committing changes on the back-end and on user input and form
        submission in the UI on the front-end side.</p></li></ol></div><p>The simplest, and most responsive, solution is the third one, using
    only JavaScript both for the back-end and front-end components of a web
    app.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e506"></a>5.&nbsp;Adding Constraints to a Design Model</h2></div></div></div><p>We again consider the book data management problem that was
    considered in   <span class="phrase">Part 1 of
    this tutorial.</span> But now we also consider the <span class="bold"><strong><span class="italic">data integrity
    rules</span></strong></span> (or 'business rules') that govern the
    management of book data. These integrity rules, or <span class="bold"><strong><span class="italic">constraints</span></strong></span>, can
    be expressed in a UML class diagram as shown in <a class="xref" href="#figBookSimpleAppDesModel" title="Figure&nbsp;1.2.&nbsp;A design model defining the object type Book with two invariants">Figure&nbsp;1.2</a>
    below.</p><div class="figure"><a name="figBookSimpleAppDesModel"></a><p class="title"><b>Figure&nbsp;1.2.&nbsp;A design model defining the object type <code class="code">Book</code> with
      two invariants</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="420"><tr><td><img src="../fig/Book_SimpleAppDesM.svg" width="420" alt="A design model defining the object type Book with two invariants"></td></tr></table></div></div></div><br class="figure-break"><p>In this model, the following constraints have been
    expressed:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Due to the fact that the <code class="code">isbn</code> attribute is
          declared to be the <span class="italic">standard
          identifier</span> of <code class="code">Book</code>, it is <span class="bold"><strong><span class="italic">mandatory</span></strong></span>
          and <span class="bold"><strong><span class="italic">unique</span></strong></span>.</p></li><li class="listitem"><p>The <code class="code">isbn</code> attribute has a <span class="bold"><strong><span class="italic">pattern
          constraint</span></strong></span> requiring its values to match the
          ISBN-10 format that admits only 10-digit strings or 9-digit strings
          followed by "X".</p></li><li class="listitem"><p>The <code class="code">title</code> attribute is <span class="bold"><strong><span class="italic">mandatory</span></strong></span>,
          as indicated by its multiplicity expression [1], and has a <span class="bold"><strong><span class="italic">string length
          constraint</span></strong></span> requiring its values to have at
          most 50 characters.</p></li><li class="listitem"><p>The <code class="code">year</code> attribute is <span class="bold"><strong><span class="italic">mandatory</span></strong></span>
          and has an <span class="bold"><strong><span class="italic">interval
          constraint</span></strong></span>, however, of a special form since
          the maximum is not fixed, but provided by the calendar function
          <code class="code">nextYear()</code>, which we implement as a utility
          function.</p></li></ol></div><p>Notice that the <code class="code">edition</code> attribute is not mandatory, but
    <span class="italic">optional</span>, as indicated by its
    multiplicity expression [0..1]. In addition to the constraints described
    in this list, there are the implicit range constraints defined by
    assigning the datatype <code class="code">NonEmptyString</code> as range to
    <code class="code">isbn</code> and <code class="code">title</code>, <code class="code">Integer</code> to
    <code class="code">year</code>, and <code class="code">PositiveInteger</code> to
    <code class="code">edition</code>. In our plain JavaScript approach, all these property
    constraints are coded in the model class within property-specific
    <span class="italic">check</span> functions.</p><p>The meaning of the design model can be illustrated by a sample data
    population respecting all constraints:</p><div class="table"><a name="d5e564"></a><p class="title"><b>Table&nbsp;1.1.&nbsp;Sample data for <code class="code">Book</code></b></p><div class="table-contents"><table frame="box" rules="all"><thead><tr>
          <th>ISBN</th>

          <th>Title</th>

          <th>Year</th>

          <th>Edition</th>
        </tr></thead><tbody><tr>
          <td>006251587X</td>

          <td>Weaving the Web</td>

          <td>2000</td>

          <td>3</td>
        </tr><tr>
          <td>0465026567</td>

          <td>G&ouml;del, Escher, Bach</td>

          <td>1999</td>

          <td>2</td>
        </tr><tr>
          <td>0465030793</td>

          <td>I Am A Strange Loop</td>

          <td>2008</td>

          <td></td>
        </tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e589"></a>6.&nbsp;Summary</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Constraints are logical conditions on the data of an app. The
        simplest, and most important, types of constraints are property
        constraints and object-level constraints.</p></li><li class="listitem"><p>Constraints should be defined in the model classes of an MVC
        app, since they are part of their business semantics.</p></li><li class="listitem"><p>Constraints should be checked in various places of an MVC app:
        in the UI/view code, in model classes, and possibly in the
        database.</p></li><li class="listitem"><p>Software applications that include CRUD data management need to
        perform two kinds of bi-directional object-to-string type
        conversions:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Between the model and the UI: converting model object
            property values to UI widget values, and, the other way around,
            converting input widget values to property values. Typically,
            widgets are form fields that have string values.</p></li><li class="listitem"><p>Between the model and the datastore: converting model
            objects to storage data sets (called serialization), and, the
            other way around, converting storage data sets to model objects
            (called de-serialization). This involves converting property
            values to storage data values, and, the other way around,
            converting storage data values to property values. Typically,
            datastores are either JavaScript's local storage or IndexedDB, or
            SQL databases, and objects have to be mapped to some form of table
            rows. In the case of an SQL database, this is called
            "Object-Relational Mapping" (ORM).</p></li></ol></div></li><li class="listitem"><p>Do not perform any string-to-property-value conversion in the UI
        code. Rather, this is the business of the model code.</p></li><li class="listitem"><p>For being able to observe how an app works, or, if it does not
        work, where it fails, it is essential to log all critical application
        events, such as data retrieval, save and delete events, at least in
        the JavaScript console.</p></li><li class="listitem"><p>Responsive validation means that the user, while typing, gets
        immediate validation feedback on each input (keystroke), and when
        requesting to save the new data.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e611"></a>7.&nbsp;Quiz Questions</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e613"></a>7.1.&nbsp;Question 1: Where to check constraints</h3></div></div></div><p>Where in the application code should the constraints be <span class="italic"><span class="bold"><strong>checked</strong></span></span>? In
      the ...</p><p>&#9744; controller code</p><p>&#9744; model classes</p><p>&#9744; user interface code</p><p>&#9744; underlying DBMS (if it supports constraint validation)</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e622"></a>7.2.&nbsp;Question 2: Where to define constraints</h3></div></div></div><p>Where in the application code should the constraints be <span class="italic"><span class="bold"><strong><span class="italic"><a name="yui_3_17_2_2_1444585883155_518"></a><span class="bold"><a name="yui_3_17_2_2_1444585883155_517"></a><strong>defined</strong></span></span></strong></span></span>?
      In the ...</p><p>&#9744; controller code</p><p>&#9744; model classes</p><p>&#9744; user interface HTML5 code</p><p>&#9744; user interface JavaScript code</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e633"></a>7.3.&nbsp;Question 3: Counting constraints</h3></div></div></div><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="220"><tr><td><img src="../fig/AuthorConstraints.svg" width="220"></td></tr></table></div></div><p>How many constraints are specified by the class model shown in the
      diagram? Select one:</p><p>O 7&#8195;O 8&#8195;O 9&#8195;O 10</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e641"></a>7.4.&nbsp;Question 4: Constraint names</h3></div></div></div><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="300"><tr><td><img src="../fig/PersonConstraints.svg" width="300"></td></tr></table></div></div><p>Which of the following constraints are specified by the class
      model?</p><p>&#9744; A <span class="italic">range constraint</span> for the
      property <code class="code">name</code>.</p><p>&#9744; A <span class="italic">uniqueness constraint</span> for
      the property <code class="code">name</code>.</p><p>&#9744; A <span class="italic">referential integrity
      constraint</span> for the property <code class="code">name</code>.</p><p>&#9744; A <span class="italic">uniqueness constraint</span> for
      the property <code class="code">age</code>.</p><p>&#9744; A mandatory value constraint for the property
      <code class="code">name</code>.</p><p>&#9744; A <span class="italic">mandatory value constraint</span>
      for the property <code class="code">age</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e665"></a>7.5.&nbsp;Question 5: Compliant objects</h3></div></div></div><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="300"><tr><td><img src="../fig/PersonConstraints.svg" width="300"></td></tr></table></div></div><p>Which of the following objects <span class="bold"><strong>do
      not</strong></span> represent admissible instances (or, in other words,
      violate a constraint) of the object type <code class="code">Person</code>?</p><p>&#9744; <code class="code">{name: 21, age: 8}</code></p><p>&#9744; <code class="code">{name: "21", age: 0}</code></p><p>&#9744; <code class="code">{name: "Susan"}</code></p><p>&#9744; <code class="code">{name: "Peter", age: 121}</code></p></div></div></div><div lang="" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chConstrValJS"></a>Chapter&nbsp;2.&nbsp;Implementing Constraint Validation in a Plain JS Web App</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#d5e685">1. Introduction</a></span></dt><dt><span class="section"><a href="#d5e711">2. New Issues</a></span></dt><dt><span class="section"><a href="#d5e767">3. Using ES6 Modules</a></span></dt><dt><span class="section"><a href="#d5e837">4. Make a JavaScript Class Model</a></span></dt><dt><span class="section"><a href="#d5e891">5. Set up the Folder Structure</a></span></dt><dd><dl><dt><span class="section"><a href="#sectSimpleAppLibFiles">5.1. Provide utility functions and error classes in library
      files</a></span></dt><dt><span class="section"><a href="#sectSimpleAppStartPage">5.2. Create a start page</a></span></dt></dl></dd><dt><span class="section"><a href="#sectSimpleAppModel">6. Write the Model Code</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e956">6.1. Summary</a></span></dt><dt><span class="section"><a href="#d5e976">6.2. Code the model class as a constructor function</a></span></dt><dt><span class="section"><a href="#d5e1026">6.3. Code the property checks</a></span></dt><dt><span class="section"><a href="#d5e1066">6.4. Code the property setters</a></span></dt><dt><span class="section"><a href="#d5e1077">6.5. Add a serialization function</a></span></dt><dt><span class="section"><a href="#d5e1084">6.6. Data management operations</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1156">7. Write the View Code</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e1209">7.1. Set up the user interface for <span class="emphasis"><em>Create
      Book</em></span></a></span></dt><dt><span class="section"><a href="#d5e1261">7.2. Set up the user interface for <span class="emphasis"><em>Update
      Book</em></span></a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1288">8. Possible Variations and Extensions</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e1290">8.1. Adding an object-level validation function</a></span></dt><dt><span class="section"><a href="#d5e1302">8.2. Using implicit JS setters</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1321">9. Points of Attention</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e1323">9.1. Boilerplate code</a></span></dt><dt><span class="section"><a href="#d5e1339">9.2. Configuring the UI for preventing invalid user input</a></span></dt><dt><span class="section"><a href="#d5e1359">9.3. Improving the user experience by showing helpful auto-complete
      suggestions</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1370">10. Quiz Questions</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e1374">10.1. Question 1: Methods to add in JS class model</a></span></dt><dt><span class="section"><a href="#d5e1401">10.2. Question 2: Implementing constraints</a></span></dt><dt><span class="section"><a href="#d5e1423">10.3. Question 3: Implementing setter methods</a></span></dt></dl></dd><dt><span class="section"><a href="#d5e1437">11. Practice Project</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e685"></a>1.&nbsp;Introduction</h2></div></div></div><p>The minimal JavaScript front-end web application that we have
    discussed in  <span class="phrase">the <a class="link" href="http://web-engineering.info/tech/JsFrontendApp/minimal-tutorial.html" target="_top">Minimal
    App Tutorial</a></span> has been limited to support the minimum
    functionality of a data management app only. For instance, it did not take
    care of preventing the user from entering invalid data into the app's
    database. In this chapter, we show how to express integrity constraints in
    a JavaScript <span class="italic">model class</span>, and how to
    perform constraint validation both in the <span class="italic">model</span> part of the app and in the user interface
    built with HTML5.</p><p>We show how to perform responsive validation with the <a class="link" href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5/Constraint_validation" target="_top">HTML5
    form validation API</a>. Since using the HTML5 <code class="code">input</code> field
    types and validation attributes (like <code class="code">required</code>,
    <code class="code">min</code>, <code class="code">max</code> and <code class="code">pattern</code>) implies
    defining constraints in the UI, they are not really useful in a
    best-practice approach where constraints are only checked, but not
    defined, in the UI.</p><p>Consequently, we will not use the HTML5 features for defining
    constraints in the UI, but only use two methods of the HTML5 form
    validation API:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="code">setCustomValidity</code>, which allows to mark a form
        field as either valid or invalid by assigning either an empty string
        or a non-empty (constraint violation) message string;</p></li><li class="listitem"><p><code class="code">checkValidity</code>, which is invoked on a form before
        user input data is committed or saved (for instance with a form
        submission); it tests, if all fields have a valid value.</p></li></ol></div><p>In the case of two special kinds of attributes, having
    <span class="emphasis"><em>calendar dates</em></span> or <span class="emphasis"><em>colors</em></span> as
    values, it is desirable to use the new UI widgets defined by HTML5 for
    picking a date or picking a color (with corresponding <code class="code">input</code>
    field types).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e711"></a>2.&nbsp;New Issues</h2></div></div></div><p>Compared to the <a class="link" href="http://web-engineering.info/tech/JsFrontendApp/MinimalApp/index.html" target="_top">Minimal
    App</a> discussed in  <span class="phrase">the <a class="link" href="http://web-engineering.info/tech/JsFrontendApp/minimal-tutorial.html" target="_top">Minimal
    App Tutorial</a></span> we have to deal with a number of new
    issues:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>In the <span class="italic">model</span> code we have to
        add for every property of a class </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>a <span class="italic"><span class="bold"><strong>check</strong></span></span> function that can be
              invoked for validating the constraints defined for the property,
              and</p></li><li class="listitem"><p>a <span class="italic"><span class="bold"><strong>setter</strong></span></span> method that invokes the
              check function and is to be used for setting the value of the
              property.</p></li></ol></div></li><li class="listitem"><p>In the <span class="italic">user interface
        ("view")</span> code we have to take care of </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p><span class="italic"><span class="bold"><strong>responsive
              validation</strong></span></span> on user input for providing
              immediate feedback to the user, by invoking
              <code class="code">setCustomValidity</code> together with the corresponding
              check function for each input field, and by marking fields with
              invalid data with the help of a new CSS style rule <code class="code">
              form:invalid {outline: red;</code>},</p></li><li class="listitem"><p>validation on form submission for preventing the
              submission of flawed data to the model layer by invoking
              <code class="code">checkValidity</code>.</p></li></ol></div><p>For improving the break-down of the view code, we introduce a
        utility method (in <code class="filename">lib/util.mjs</code>) that fills a
        <code class="code">select</code> form control with <code class="code">option</code> elements the
        contents of which is retrieved from an entity table such as
        <code class="code">Book.instances</code>. This method is used both in the
        <code class="code">updateBook</code> and the <code class="code">deleteBook</code> use
        cases.</p></li><li class="listitem"><p>As a namespace approach (for avoiding name conflicts), we will
        now use ES6 <span class="bold"><strong>modules</strong></span>, instead of a
        global namespace object with subnamespace objects, like <code class="code">pl =
        {m:{}, v:{}, c:{}}</code>.</p></li></ol></div><p>Checking the constraints in the user interface (UI) on user input is
    important for providing immediate feedback to the user. But it is not safe
    enough to perform constraint validation only in the UI, because this could
    be circumvented in a distributed web application where the UI runs in the
    web browser of a front-end device while the application's data is managed
    by a back-end component on a remote web server. Consequently, we need
    multiple constraint validation, first in the UI <span class="italic">on
    input</span> (or <span class="italic">on change</span>) and
    <span class="italic">on form submission</span>, and subsequently in
    the model layer before saving/sending data to the persistent data store.
    And in an application based on a DBMS we may also use a third round of
    validation before persistent storage by using the validation mechanisms of
    the DBMS. This is a must, when the application's database is shared with
    other apps.</p><p>Our proposed solution to this <span class="emphasis"><em>multiple validation
    problem<a class="indexterm" name="d5e760"></a></em></span> is to keep the constraint validation code in
    special <span class="italic">check</span> functions in the model
    classes and invoke these functions both in the UI on user input and on
    form submission, as well as in the <span class="italic">create</span> and <span class="italic">update</span> data management methods of the model class
    via invoking the setters. Notice that <span class="italic">referential
    integrity</span> constraints (and other relationship constraints) may
    also be violated through a <span class="italic">delete</span>
    operation, but in our single-class example we don't have to consider
    this.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e767"></a>3.&nbsp;Using ES6 Modules</h2></div></div></div><p>Normal modules are library code files that explicitly <span class="bold"><strong>export</strong></span> those (variable, function and class) names
    that other modules can use (as implicitly frozen like <code class="code">const</code>
    declarations). A module that is to use items from another module needs to
    explicitly <span class="bold"><strong>import</strong></span> them from that other
    module using import statements. It is recommended that all JS module files
    use the file extension "mjs" for indicating that they are different from
    classical script files.</p><div class="sidebar"><div class="titlepage"></div><p>When developing apps with ES6 modules, you should use <span class="emphasis"><em>Firefox</em></span>
        because its security settings can be easily configured such that it allows loading modules
        directly from the local file system by disabling the flag "strict_origin_policy"
        specifically for file URLs:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Enter "<span class="bold"><strong>about:config</strong></span>" in the Firefox search
            bar.</p></li><li class="listitem"><p>Search for "<span class="bold"><strong>security.fileuri.strict_origin_policy</strong></span>".</p></li><li class="listitem"><p>Disable this policy by changing its value from <span class="bold"><strong>true</strong></span>
            to <span class="bold"><strong>false</strong></span>.</p></li></ol></div><p>This creates only a small security risk because the important web security policy called
        "CORS" is only disabled for file URLs, but not for normal URLs.</p><p>For other browsers, like Chrome, you need to install a local HTTP server and load your
        app's webpages from that local server, or run them via WebStorm (which has a built-in local
        server), because the only option for loading ES6 modules from the local file system in
        Chrome would be to disable the CORS policy completely (see <a class="link" href="https://windowsreport.com/browser-not-support-cross-origin/" target="_top">how to disable
          CORS in Chrome</a>), but that would create a severe security risk and is therefore not
        recommended.</p></div><p>Web pages can load module files, possibly along with classical
    script files, with the help of a special type of <code class="code">script</code>
    element.</p><p>The meaning of ES6 modules is based on the following
    principles:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A JS library file can be turned into a module by using "export"
        for all library items. Other modules can "import" its items.</p></li><li class="listitem"><p>Any ordinary script file that is to use one or more items from a
        module has itself to be turned into a module ("only modules can use
        modules"). Since it doesn't export anything, such a module could also
        be called an "import module".</p></li><li class="listitem"><p>All modules, no matter if they export anything or are just
        "import modules", are separated from the global scope in the following
        sense: they have read access to items from the global scope such as
        DOM objects (like <code class="code">document</code>) or other global objects (like
        <code class="code">Array</code>), but they cannot create any names (including
        objects and functions) in the global scope. This implies, for
        instance, that a JS function defined in a module cannot be assigned to
        an <code class="code">onclick</code> event handler attribute in an HTML
        file..</p></li></ol></div><p>Using modules implies that we can no longer use the global scope for
    the names of functions/classes, which is a restriction that is considered
    a good practice in software engineering.</p><p>An example of a normal (library) module file is
    <code class="filename">util.mjs</code> with the following code:</p><pre class="programlisting">function <span class="bold"><strong>isNonEmptyString</strong></span>(x) {
  return typeof(x) === "string" &amp;&amp; x.trim() !== "";
}
...
<span class="bold"><strong>export</strong></span> { isNonEmptyString, ... };</pre><p>An example of a module that imports certain items from other modules
    and then uses them in its own code, and also exports some of its own items
    is the model class file <code class="filename">Book.mjs</code> with the following
    import/export statements:</p><pre class="programlisting"><span class="bold"><strong>import</strong></span> { isNonEmptyString, ... } from "../../lib/util.mjs";
<span class="bold"><strong>import</strong></span> { NoConstraintViolation, MandatoryValueConstraintViolation, ... }
    from "../../lib/errorTypes.mjs";<span class="bold"><strong>
export</strong></span> default function <span class="bold"><strong>Book</strong></span>( slots) {...}</pre><p>Since this module only exports one class
    (<span class="emphasis"><em>Book</em></span>), a default export us used, allowing simplified
    imports.</p><p>An example of a module that does not export anything, but only
    imports certain items, is the view code file
    <code class="filename">createBook.mjs</code> with the following import
    statements:</p><pre class="programlisting"><span class="bold"><strong>import</strong></span> Book from "../../src/m/Book.mjs";
<span class="bold"><strong>import</strong></span> { fillSelectWithOptions } from "../../lib/util.mjs";
...</pre><p>An HTML page (here: <code class="filename">createBook.html</code>) can load
    such a module with a special type of <code class="code">script</code> element:</p><pre class="programlisting">&lt;script src="src/v/createBook.mjs" <span class="bold"><strong>type="module"</strong></span>&gt;&lt;/script&gt;</pre><p>Notice that this <code class="code">script</code> element's <code class="code">type</code>
    attribute is set to "module".</p><p>Alternatively, the code of such a module can be embedded in the HTML
    page like so:</p><pre class="programlisting">&lt;script <span class="bold"><strong>type="module"</strong></span>&gt;
 <span class="bold"><strong>import</strong></span> Book from "./src/m/<span class="bold"><strong>Book.mjs</strong></span>";
 const clearButton = document.getElementById("clearData");
 // Set event handler for the button "clearData"
 clearButton.addEventListener("click", function () {<span class="bold"><strong>Book</strong></span>.clearData();});
&lt;/script&gt;.</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e837"></a>4.&nbsp;Make a JavaScript Class Model</h2></div></div></div><p>Using the information design model shown in <a class="xref" href="#figBookSimpleAppDesModel" title="Figure&nbsp;1.2.&nbsp;A design model defining the object type Book with two invariants">Figure&nbsp;1.2</a> above as
    the starting point, we make a <span class="italic">JavaScript</span> class model by performing the
    following steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Create a <span class="italic"><span class="bold"><strong>check</strong></span></span> operation for each
        (non-derived) property in order to have a central place for
        implementing all the constraints that have been defined for a property
        in the design model. For a standard identifier attribute, such as
        <code class="code">Book::isbn</code>, two check operations are needed:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>A basic check operation, such as <code class="code">checkIsbn</code>,
              for checking all basic constraints of the attribute, except the
              <span class="italic">mandatory value</span> and the
              <span class="italic">uniqueness</span>
              constraints.</p></li><li class="listitem"><p>An extended check operation, such as
              <code class="code">checkIsbnAsId</code>, for checking, in addition to the
              basic constraints, the <span class="italic">mandatory
              value</span> and <span class="italic">uniqueness</span> constraints that are
              required for a standard identifier attribute.</p></li></ol></div><p>The <code class="code">checkIsbnAsId</code> operation is invoked on
        user input for the <code class="code">isbn</code> form field in the <span class="italic">create book</span> form, and also in the
        <code class="code">setIsbn</code> method, while the <code class="code">checkIsbn</code>
        operation can be used for testing if a value satisfies the syntactic
        constraints defined for an ISBN.</p></li><li class="listitem"><p>Create a <span class="bold"><strong>setter</strong></span> operation for
        each (non-derived) <span class="bold"><strong><span class="italic">single-valued</span></strong></span> property. In the
        setter, the corresponding check operation is invoked and the property
        is only set, if the check does not detect any constraint
        violation.</p></li></ol></div><p>This leads to the <span class="italic">JavaScript class
    model</span> shown on the right-hand side of the mapping arrow in the
    following figure.</p><div class="figure"><a name="figIDM2JsDM"></a><p class="title"><b>Figure&nbsp;2.1.&nbsp;From an information design model to a JS class model</b></p><div class="figure-contents"><div class="informaltable"><table frame="void"><tbody><tr>
            <td><div class="mediaobject"><img src="../fig/Book_SimpleAppDesM2.svg" alt="From an information design model to a JS class model"></div></td>

            <td><div class="mediaobject"><img src="../fig/Rightarrow.png" alt="From an information design model to a JS class model"></div></td>

            <td><div class="mediaobject"><img src="../fig/Book_SimpleAppJsDataM.svg" alt="From an information design model to a JS class model"></div></td>
          </tr></tbody></table></div></div></div><br class="figure-break"><p>Essentially, the JS class model extends the design model by adding
    checks and setters for each property. The attached invariants have been
    dropped since they are taken care of in the checks. Property ranges have
    been turned into JavaScript datatypes (with a reminder to their real range
    in curly braces). Notice that the names of check functions are underlined,
    since this is the convention in UML for <span class="italic">class-level</span> (as opposed to <span class="italic">instance-level</span>) operations.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e891"></a>5.&nbsp;Set up the Folder Structure</h2></div></div></div><p>The folder structure of the validation app extends the folder
    structure of the minimal app by adding two subfolders:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>a <code class="filename">css</code> folder containing CSS style files for
        styling the user interface pages of the app;</p></li><li class="listitem"><p>a <code class="filename">lib</code> folder containing the code library
        files <code class="filename">errorTypes.mjs</code> and
        <code class="filename">util.mjs</code>.</p></li></ol></div><p>Thus, we get the following folder structure:</p><pre class="programlisting">publicLibrary
  <span class="bold"><strong>css</strong></span>
    main.css
    normalize.css
  <span class="bold"><strong>lib</strong></span>
    errorTypes.mjs
    util.mjs
  src
    m
    v
  index.html</pre><p>Notice that the <code class="filename">src</code> folder only contains two
    subfolders <code class="filename">m</code> and <code class="filename">v</code> (for
    <span class="emphasis"><em>model</em></span> and <span class="emphasis"><em>view</em></span>), as we have
    dropped the <code class="filename">c</code> folder since the minimal app's
    <span class="emphasis"><em>controller</em></span> code for defining namespace objects is no
    longer needed due to the use of ES6 modules.</p><p>We discuss the contents of the added library files in the following
    subsections.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sectSimpleAppLibFiles"></a>5.1.&nbsp;Provide utility functions and error classes in library
      files</h3></div></div></div><p>We add two library files (in the form of ES6
      <span class="emphasis"><em>modules</em></span>) to the <code class="filename">lib</code> folder:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="filename">util.mjs</code> contains the definitions of a
            few utility functions such as <code class="code">isNonEmptyString(x)</code> for
            testing if <code class="code">x</code> is a non-empty string.</p></li><li class="listitem"><p><code class="filename">errorTypes.mjs</code> defines classes for
            error (or exception) types corresponding to the basic types of
            property constraints discussed above:
            StringLengthConstraintViolation,
            MandatoryValueConstraintViolation, RangeConstraintViolation,
            IntervalConstraintViolation, PatternConstraintViolation,
            UniquenessConstraintViolation. In addition, a class <span class="italic">NoConstraintViolation</span> is defined for
            being able to return a validation result object in the case of no
            constraint violation.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sectSimpleAppStartPage"></a>5.2.&nbsp;Create a start page</h3></div></div></div><p>The start page <code class="filename">index.html</code> takes care of
      loading CSS style files with the help of the following two
      <code class="code">link</code> elements: </p><pre class="programlisting">&lt;link rel="stylesheet" href="css/normalize.css"&gt;
&lt;link rel="stylesheet" href="css/main.css"&gt;</pre><p>The first CSS file (<a class="link" href="https://necolas.github.io/normalize.css/" target="_top">normalize.css</a>)
      is a widely used collection of style normalization rules making browsers
      render all HTML elements more consistently. The second file (main.css)
      contains the specific styles of the app's user interface (UI)
      pages.</p><p>Since the app's start page does not provide much UI functionality,
      but only a few navigation links and two buttons, only a few lines of
      code are needed for setting up the buttons' event listeners. This is
      taken care of in an embedded <code class="literal">script</code> element of type
      <code class="code">module</code>:</p><pre class="programlisting">&lt;script <span class="bold"><strong>type="module"</strong></span>&gt;
 <span class="bold"><strong>import</strong></span> <span class="bold"><strong>Book</strong></span> from "./src/m/<span class="bold"><strong>Book.mjs</strong></span>";
 const clearButton = document.getElementById("clearData"),
       generateTestDataButtons = document.querySelectorAll("button.generateTestData");
 // Set event handler for the button "clearData"
 clearButton.addEventListener("click", Book.<span class="bold"><strong>clearData</strong></span>);
 for (const btn of generateTestDataButtons) {
   btn.addEventListener("click", Book.<span class="bold"><strong>generateTestData</strong></span>);
 }
&lt;/script&gt;.</pre><p>Notice how the Book class is loaded by importing the module
      <code class="filename">Book.mjs</code> from the <code class="filename">src/m</code>
      folder.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sectSimpleAppModel"></a>6.&nbsp;Write the Model Code</h2></div></div></div><p>The JS class model shown on the right hand side in <a class="xref" href="#figIDM2JsDM" title="Figure&nbsp;2.1.&nbsp;From an information design model to a JS class model">Figure&nbsp;2.1</a> can be coded step by
    step for getting the code of the model layer of our JavaScript front-end
    app. These steps are summarized in the following section.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e956"></a>6.1.&nbsp;Summary</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Code the model class as a JavaScript constructor
          function.</p></li><li class="listitem"><p><span class="italic"><span class="bold"><strong>Code the check
          functions</strong></span></span>, such as <code class="code">checkIsbn</code> or
          <code class="code">checkTitle</code>, in the form of class-level ('static')
          methods. Take care that all constraints, as specified in the JS
          class model, are properly coded in the check functions.</p></li><li class="listitem"><p><span class="italic"><span class="bold"><strong>Code the setter
          operations</strong></span></span>, such as <code class="code">setIsbn</code> or
          <code class="code">setTitle</code>, as (instance-level) methods. In the setter,
          the corresponding check operation is invoked and the property is
          only set, if the check does not detect any constraint
          violation.</p></li><li class="listitem"><p>Code the add and remove operations, if there are any, as
          instance-level methods.</p></li></ol></div><p>These steps are discussed in more detail in the following
      sections.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e976"></a>6.2.&nbsp;Code the model class as a constructor function</h3></div></div></div><p>The class <code class="code">Book</code> is coded as a corresponding <span class="italic">constructor function</span> with the same name
      <code class="code">Book</code> such that all its (non-derived) properties are
      supplied with values from corresponding key-value slots of a
      <code class="code">slots</code> parameter.</p><pre class="programlisting">function <span class="bold"><strong>Book</strong></span>( slots) {
  // assign default values
  this.isbn = "";   // string
  this.title = "";  // string
  this.year = 0;    // number (int)
  // assign properties only if the constructor is invoked with an argument
  if (arguments.length &gt; 0) {
    this.setIsbn( slots.isbn); 
    this.setTitle( slots.title); 
    this.setYear( slots.year);
    // optional property
    if (slots.edition) this.setEdition( slots.edition);
  }
};</pre><p>In the constructor body, we first assign default values to the
      class properties. These values will be used when the constructor is
      invoked as a default constructor (without arguments), or when it is
      invoked with only some arguments. It is helpful to indicate the range of
      a property in a comment. This requires to map the platform-independent
      datatypes of the information design model to the corresponding implicit
      JavaScript datatypes<a class="indexterm" name="d5e986"></a> according to the following table.</p><div class="table"><a name="d5e989"></a><p class="title"><b>Table&nbsp;2.1.&nbsp;Datatype mapping</b></p><div class="table-contents"><table frame="box" rules="all"><thead><tr>
            <th>Platform-independent datatype</th>

            <th>JavaScript datatype</th>

            <th>SQL</th>
          </tr></thead><tbody><tr>
            <td>String</td>

            <td>string</td>

            <td>CHAR(<span class="italic">n</span>) or
            VARCHAR(<span class="italic">n</span>)</td>
          </tr><tr>
            <td>Integer</td>

            <td>number (int)</td>

            <td>INTEGER</td>
          </tr><tr>
            <td>Decimal</td>

            <td>number (float)</td>

            <td>REAL, DOUBLE PRECISION or DECIMAL(<span class="italic">p</span>,<span class="italic">s</span>)</td>
          </tr><tr>
            <td>Boolean</td>

            <td>boolean</td>

            <td>BOOLEAN</td>
          </tr><tr>
            <td>Date</td>

            <td>Date</td>

            <td>DATE</td>
          </tr></tbody></table></div></div><br class="table-break"><p>Since the setters may throw constraint violation errors, the
      constructor function, and any setter, should be called in a try-catch
      block where the catch clause takes care of processing errors (at least
      logging suitable error messages).</p><p>As in the minimal app, we add a class-level property
      <code class="code">Book.instances</code> representing the collection of all
      <code class="code">Book</code> instances managed by the app in the form of an entity
      table: </p><pre class="programlisting">Book.instances = {};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1026"></a>6.3.&nbsp;Code the property checks</h3></div></div></div><p>Code the property check functions in the form of class-level
      ('static') methods. In JavaScript, this means to define them as method
      slots of the constructor, as in <code class="code">Book.checkIsbn</code> (recall that
      a constructor is a JS object, since in JavaScript, functions are
      objects, and as an object, it can have slots).</p><p>Take care that all constraints of a property as specified in the
      class model are properly coded in its check function. This concerns, in
      particular, the <span class="italic">mandatory value</span> and
      <span class="italic">uniqueness</span> constraints implied by the
      <span class="italic">standard identifier</span> declaration (with
      <code class="code">{id}</code>), and the <span class="italic">mandatory
      value</span> constraints for all properties with multiplicity 1,
      which is the default when no multiplicity is shown. If any constraint is
      violated, an error object instantiating one of the error classes listed
      above in <a class="xref" href="#sectSimpleAppLibFiles" title="5.1.&nbsp;Provide utility functions and error classes in library files">Section&nbsp;5.1</a> and defined in the file
      <code class="filename">errorTypes.mjs</code> is returned.</p><p>For instance, for the <code class="code">checkIsbn</code> operation we obtain
      the following code:</p><pre class="programlisting">Book.<span class="bold"><strong>checkIsbn</strong></span> = function (id) {
  if (!id) {
    return new NoConstraintViolation();
  } else if (typeof id !== "string" || id.trim() === "") {
    return new <span class="bold"><strong>RangeConstraintViolation</strong></span>(
        "The ISBN must be a non-empty string!");
  } else if (!/\b\d{9}(\d|X)\b/.test( id)) {
    return new <span class="bold"><strong>PatternConstraintViolation</strong></span>(
        "The ISBN must be a 10-digit string or "+
        " a 9-digit string followed by 'X'!");
  } else {
    return new NoConstraintViolation();
  }
};</pre><p>Notice that, since <code class="code">isbn</code> is the standard identifier
      attribute of <code class="code">Book</code>, we only check the syntactic constraints
      in <code class="code">checkIsbn</code>, but we check the <span class="italic">mandatory value</span> and <span class="italic">uniqueness</span> constraints in
      <code class="code">checkIsbnAsId</code>, which itself first invokes
      <code class="code">checkIsbn</code>:</p><pre class="programlisting">Book.<span class="bold"><strong>checkIsbnAsId</strong></span> = function (id) {
  var constraintViolation = Book.checkIsbn( id);
  if ((constraintViolation instanceof NoConstraintViolation)) {
    if (!id) {
      constraintViolation = new <span class="bold"><strong>MandatoryValueConstraintViolation</strong></span>(
          "A value for the ISBN must be provided!");
    } else if (Book.instances[id]) {  
      constraintViolation = new <span class="bold"><strong>UniquenessConstraintViolation</strong></span>(
          "There is already a book record with this ISBN!");
    } else {
      constraintViolation = new NoConstraintViolation();
    } 
  }
  return constraintViolation;
};</pre><p>We assume that all check functions and setters can deal both with
      proper data values (that are of the attribute's range type) and also
      with string values that are supposed to represent proper data values,
      but have not yet been converted to the attribute's range type. We take
      this approach for avoiding datatype conversions in the user interface
      ("view") code. Notice that all data entered by a user in an HTML form
      field is of type String and must be converted (or de-serialized) before
      its validity can be checked and it can be assigned to the corresponding
      property. It is preferable to perform these type conversions in the
      model code, and not in the user interface code..</p><p>For instance, in our example app, we have the integer-valued
      attribute <code class="code">year</code>. When the user has entered a value for this
      attribute in a corresponding form field, in the <span class="italic">Create</span> or <span class="italic">Update</span> user interface, the form field holds a
      string value. This value is passed to the <code class="code">Book.add</code> or
      <code class="code">Book.update</code> method, which invokes the <code class="code">setYear</code>
      and <code class="code">checkYear</code> methods. Only after being validated, this
      string value is converted to an integer and assigned to the
      <code class="code">year</code> attribute.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1066"></a>6.4.&nbsp;Code the property setters</h3></div></div></div><p>Code the setter operations as (instance-level) methods. In the
      setter, the corresponding check function is invoked and the property is
      only set, if the check does not detect any constraint violation.
      Otherwise, the <span class="italic">constraint violation</span>
      error object returned by the check function is thrown. For instance, the
      <code class="code">setIsbn</code> operation is coded in the following way:
      </p><pre class="programlisting">Book.prototype.<span class="bold"><strong>setIsbn</strong></span> = function (id) {
  const validationResult = Book.checkIsbnAsId( id);
  if (validationResult instanceof NoConstraintViolation) {
    this.isbn = id;
  } else {
    throw validationResult;
  }
};</pre><p>There are similar setters for the other properties
      (<code class="code">title</code>, <code class="code">year</code> and <code class="code">edition</code>).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1077"></a>6.5.&nbsp;Add a serialization function</h3></div></div></div><p>It is helpful to have an object serialization function tailored to
      the structure of an object (as defined by its class) such that the
      result of serializing an object is a human-readable string
      representation of the object showing all relevant information items of
      it. By convention, these functions are called <code class="code">toString()</code>.
      In the case of the <code class="code">Book</code> class, we use the following code:
      </p><pre class="programlisting">Book.prototype.<span class="bold"><strong>toString</strong></span> = function () {
  var bookStr = `Book{ ISBN: ${this.isbn}, title: ${this.title}, year: ${this.year}`;
  if (this.edition) bookStr += `, edition: ${this.edition}`;
  return bookStr;
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1084"></a>6.6.&nbsp;Data management operations</h3></div></div></div><p>In addition to defining the model class in the form of a
      constructor function with property definitions, checks and setters, as
      well as a <code class="code">toString()</code> serialization function, we also need
      to define the following data management operations as class-level
      methods of the model class: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="code">Book.convertRec2Obj</code> and
            <code class="code">Book.retrieveAll</code> for loading all managed Book
            instances from the persistent data store.</p></li><li class="listitem"><p><code class="code">Book.saveAll</code> for saving all managed Book
            instances to the persistent data store.</p></li><li class="listitem"><p><code class="code">Book.add</code> for creating a new Book instance and
            adding it to the collection of all Book instances.</p></li><li class="listitem"><p><code class="code">Book.update</code> for updating an existing Book
            instance.</p></li><li class="listitem"><p><code class="code">Book.destroy</code> for deleting a Book
            instance.</p></li><li class="listitem"><p><code class="code">Book.createTestData</code> for creating a few sample
            book records to be used as test data.</p></li><li class="listitem"><p><code class="code">Book.clearData</code> for clearing the book data
            store.</p></li></ol></div><p>All of these methods essentially have the same code as in our
      <span class="italic">minimal app</span> discussed in Part 1,
      except that now </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>we may have to catch constraint violations in suitable
            <span class="emphasis"><em>try-catch</em></span> blocks in the <code class="code">Book</code>
            procedures <code class="code">convertRec2Obj</code>, <code class="code">add</code>,
            <code class="code">update</code> and <code class="code">createTestData</code>;</p></li><li class="listitem"><p>we create more informative status and error log messages for
            better observing what's going on; and</p></li><li class="listitem"><p>we can use the <code class="code">toString()</code> function for
            serializing an object in status and error messages.</p></li></ol></div><p>Notice that for the change operations <code class="code">add</code> (create)
      and <code class="code">update</code>, we need to implement an all-or-nothing policy:
      whenever there is a constraint violation for a property, no new object
      must be created and no (partial) update of the affected object must be
      performed.</p><p>When a constraint violation is detected in one of the setters
      called when <code class="code">new Book(...)</code> is invoked in
      <code class="code">Book.add</code>, the object creation attempt fails, and instead a
      constraint violation error message is created. Otherwise, the new book
      object is added to <code class="code">Book.instances</code> and a status message is
      created, as shown in the following program listing: </p><pre class="programlisting">Book.<span class="bold"><strong>add</strong></span> = function (slots) {
  try {
    const book = new Book( slots);
    Book.instances[book.isbn] = book;
    console.log(`Book record ${book.toString()} created!`);
  } catch (e) {
    console.log(`${e.constructor.name}: ${e.message}`);
  }
};</pre><p>When an object of a model class is to be updated, we first create
      a clone of it for being able to restore it if the update attempt fails.
      In the object update attempt, we only assign those properties of the
      object the value of which has changed, and we report this in a status
      log.</p><p>Normally, all properties defined by a model class, except the
      standard identifier attribute, can be updated. It is, however, possible
      to also allow updating the standard identifier attribute. This requires
      special care for making sure that all references to the given object via
      its old standard identifier are updated as well.</p><p>When a constraint violation is detected in one of the setters
      invoked in <code class="code">Book.update</code>, the object update attempt fails,
      and instead the error message of the constraint violation object thrown
      by the setter and caught in the <code class="code">update</code> method is shown, and
      the previous state of the object is restored. Otherwise, a status
      message is created, as shown in the following program listing:</p><pre class="programlisting">Book.<span class="bold"><strong>update</strong></span> = function (slots) {
  var noConstraintViolated = true,
      updatedProperties = [];
  const book = Book.instances[slots.isbn],
        objectBeforeUpdate = cloneObject( book);
  try {
    if (book.title !== slots.title) {
      book.setTitle( slots.title);
      updatedProperties.push("title");
    }
    if (book.year !== parseInt( slots.year)) {
      book.setYear( slots.year);
      updatedProperties.push("year");
    }
    if (slots.edition &amp;&amp; slots.edition !== book.edition) {
      // slots.edition has a non-empty value that is new
      book.setEdition( slots.edition);
      updatedProperties.push("edition");
    } else if (!slots.edition &amp;&amp; book.edition !== undefined) {
      // slots.edition has an empty value that is new
      delete book.edition;  // unset the property "edition"
      updatedProperties.push("edition");
    }
  } catch (e) {...}
  ...
};</pre><p>Notice that optional properties, like <code class="code">edition</code>, need
      to be treated in a special way. If the user doesn't enter any value for
      them in a <span class="italic">Create</span> or <span class="italic">Update</span> user interface, the form field's value
      is the empty string <code class="code">""</code>. In the case of an optional
      property, this means that the property is not assigned a value in the
      <span class="italic">add</span> use case, or that it is <span class="italic">unset</span> if it has had a value in the <span class="italic">update</span> use case. This is different from the
      case of a mandatory property, where the empty string value obtained from
      an empty form field may or may not be an admissible value.</p><p>If there is a constraint violation exception, an error message is
      written to the log and the object concerned is reset to its previous
      state:</p><pre class="programlisting">Book.<span class="bold"><strong>update</strong></span> = function (slots) {
  ...
  try {
    ...
  } catch (e) {
    console.log( e.constructor.name +": "+ e.message);
    noConstraintViolated = false;
    // restore object to its state before updating
    <span class="bold"><strong>Book.instances[slots.isbn] = objectBeforeUpdate</strong></span>;
  }
  if (noConstraintViolated) {
    if (updatedProperties.length &gt; 0) {
      console.log(`Properties ${updatedProperties.toString()}` + 
          `modified for book ${slots.isbn}`);
    } else {
      console.log(`No property value changed for book ${slots.isbn}!`);
    }
  }
};</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1156"></a>7.&nbsp;Write the View Code</h2></div></div></div><p>The user interface (UI) consists of a start page
    <code class="filename">index.html</code> that allows the user choosing one of the
    data management operations by navigating to the corresponding UI page such
    as <code class="filename">retrieveAndListAllBooks.html</code> or
    <code class="filename">createBook.html</code>.</p><p>The start page <code class="filename">index.html</code> has been discussed
    above in <a class="xref" href="#sectSimpleAppStartPage" title="5.2.&nbsp;Create a start page">Section&nbsp;5.2</a>. It sets up two buttons for clearing the app's
    database by invoking the procedure <code class="code">Book.clearData()</code> and for
    creating sample data by invoking the procedure
    <code class="code">Book.createTestData()</code> from the buttons' <code class="code">click</code>
    event listeners.</p><p>Each data management UI page <span class="italic">useCase</span><code class="filename">.html</code> loads the same
    basic CSS and JavaScript files like the start page
    <code class="filename">index.html</code> discussed above. In addition, it loads a
    use-case-specific view module file <code class="filename">src/v/</code><span class="italic">useCase</span><code class="filename">.mjs</code>. The CSS file
    <code class="filename">main.css</code> now contains the following rule for marking
    invalid form fields by drawing a red outline:</p><pre class="programlisting"><code class="code">form:invalid {
    outline: dotted red;</code>
} </pre><p>For setting up the user interfaces of the data management use cases,
    we have to distinguish the case of "Retrieve/List All" from the other ones
    (Create, Update, Delete). While the latter ones require using an HTML form
    and attaching event handlers to form controls, in the case of
    "Retrieve/List All" we only have to render a table displaying all books,
    as in the case of the <a class="link" href="http://web-engineering.info/tech/JsFrontendApp/1-MinimalApp/index.html" target="_top">Minimal
    App</a> discussed in   <span class="phrase">Part 1
    of this tutorial.</span></p><p>For all four CRUD user interfaces, in the use-case-specific view
    module file <code class="filename">src/v/</code><span class="italic">useCase</span><code class="filename">.mjs</code>, we need three
    code blocks for</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>importing the <code class="code">Book</code> class and possibly other
        items,</p></li><li class="listitem"><p>loading data (in particular, all book records), and</p></li><li class="listitem"><p>defining variables for accessing various UI elements.</p></li></ol></div><p>These three steps may look like so:</p><pre class="programlisting">// import classes and other items
import <span class="bold"><strong>Book</strong></span> from "../m/Book.mjs";
// load data<span class="bold"><strong>
Book</strong></span>.retrieveAll();
// define variables for accessing UI elements
const formEl = document.forms["Book"],
      saveButton = formEl["commit"];</pre><p>In addition, in the three cases of Create, Update and Delete, we
    have to add several code blocks for defining event listeners for:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>responsive validation on form field <code class="code">input</code>
        events,</p></li><li class="listitem"><p>handling the event when the user pushes the <span class="italic">save</span> (or <span class="italic">delete</span>) button,</p></li><li class="listitem"><p>making sure the main memory data is saved when a
        <code class="code">beforeunload</code> event occurs, that is, when the browser
        window/tab is closed.</p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1209"></a>7.1.&nbsp;Set up the user interface for <span class="emphasis"><em>Create
      Book</em></span></h3></div></div></div><p>For the use case <span class="italic">Create</span>, we
      obtain the following code (in <code class="filename">v/createBook.mjs</code>) for
      adding event listeners for <span class="emphasis"><em>responsive
      validation</em></span>:</p><pre class="programlisting">formEl.<span class="bold"><strong>isbn</strong></span>.addEventListener("input", function () {formEl.isbn.setCustomValidity(
      Book.checkIsbnAsId( formEl.isbn.value).message);
});
formEl.<span class="bold"><strong>title</strong></span>.addEventListener("input", function () {formEl.title.setCustomValidity(
      Book.checkTitle( formEl.title.value).message);
});
formEl.<span class="bold"><strong>year</strong></span>.addEventListener("input", function () {formEl.year.setCustomValidity(
      Book.checkYear( formEl.year.value).message);
});
formEl.<span class="bold"><strong>edition</strong></span>.addEventListener("input", function () {formEl.edition.setCustomValidity(
      Book.checkEdition( formEl.edition.value).message);
});</pre><p>Notice that for each input field we add a listener for
      <code class="code">input</code> events, such that on any user input a validation
      check is performed because <code class="code">input</code> events are created by user
      input actions such as typing. We use the predefined function
      <code class="code">setCustomValidity</code> from the HTML5 form validation
      API<a class="indexterm" name="d5e1226"></a> for having our property check functions invoked on the
      current value of the form field and returning an error message in the
      case of a constraint violation. So, whenever the string represented by
      the expression <code class="code">Book.checkIsbn( formEl.isbn.value).message</code>
      is empty, everything is fine. Otherwise, if it represents an error
      message, the browser indicates the constraint violation to the user by
      rendering a red outline for the form field concerned (due to our CSS
      rule for the <code class="code">:invalid</code> pseudo class).</p><p>In addition to the event handlers for responsive constraint
      validation, we need two more event handlers: one for validation on form
      data submission and one for the event when the browser window (or tab)
      is closed.</p><p>While the validation on user input enhances the usability of the
      UI by providing immediate feedback to the user, validation on form data
      submission is even more important for catching invalid data. In the form
      data submission event handler, the property checks are performed again
      (with the help of <code class="code">setCustomValidity</code>), as shown in the
      following program listing:</p><pre class="programlisting"><span class="bold"><strong>saveButton</strong></span>.addEventListener("<span class="bold"><strong>click</strong></span>", function () {
  const slots = { isbn: formEl.isbn.value,
          title: formEl.title.value,
          year: formEl.year.value };
  // set error messages in case of constraint violations
  formEl.isbn.setCustomValidity( 
      Book.<span class="bold"><strong>checkIsbnAsId</strong></span>( slots.isbn).message);
  formEl.title.setCustomValidity( 
      Book.<span class="bold"><strong>checkTitle</strong></span>( slots.title).message);
  formEl.year.setCustomValidity( 
      Book.<span class="bold"><strong>checkYear</strong></span>( slots.year).message);
  if (formEl.edition.value) {
    slots.edition = formEl.edition.value;
    formEl.edition.setCustomValidity( 
        Book.<span class="bold"><strong>checkEdition</strong></span>( slots.edition).message);
  }
  // save the input data only if all of the form fields are valid
  if (formEl.<span class="bold"><strong>checkValidity</strong></span>()) Book.add( slots);
});</pre><p>By invoking <code class="code">checkValidity()</code> on the form element, we
      make sure that the form data is only saved (by <code class="code">Book.add</code>),
      if there is no constraint violation. After this event handler has been
      executed on an invalid form, the browser takes control and tests if the
      predefined property <code class="code">validity</code> has an error flag for any form
      field. In our approach, since we use <code class="code">setCustomValidity</code>, the
      <code class="code">validity.customError</code> would be true. If this is the case,
      the custom constraint violation message will be displayed (in a
      bubble).</p><p>Since the <span class="emphasis"><em>Save</em></span> button has the type "submit",
      clicking it creates a <span class="emphasis"><em>submit</em></span> event. For suppressing
      the browser's built-in <span class="emphasis"><em>submit</em></span> event processing, we
      invoke the DOM operation <code class="code">preventDefault</code> in a
      <span class="emphasis"><em>submit</em></span> event handler like so:</p><pre class="programlisting">formEl.addEventListener("<span class="bold"><strong>submit</strong></span>", function (e) {
  e.<span class="bold"><strong>preventDefault</strong></span>();
  formEl.reset();
});</pre><p>Finally, still in the module
      <code class="filename">v/createBook.mjs</code>, we set a handler for the event
      when the browser window (or tab) is closed, taking care to save all data
      to persistent storage:</p><pre class="programlisting">window.addEventListener("beforeunload", Book.saveAll);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1261"></a>7.2.&nbsp;Set up the user interface for <span class="emphasis"><em>Update
      Book</em></span></h3></div></div></div><p>In the UI of the use case <span class="italic">Update</span>, which is handled in
      <code class="filename">v/updateBook.mjs</code>, we do not have an
      <code class="code">input</code>, but rather an <code class="code">output</code> field for the
      standard identifier attribute <code class="code">isbn</code>, since it is not
      supposed to be modifiable. Consequently, we don't need to validate any
      user input for it. However, we need to set up a selection list (in the
      form of an HTML <code class="code">select</code> element) allowing the user to select
      a book in the first step, before its data can be modified. This requires
      to add a <code class="code">change</code> event listener on the <code class="code">select</code>
      element such that the fields of the HTML form can be filled with the
      data of the selected object, as taken care of by the following
      code:</p><pre class="programlisting">// define variables for accessing UI elements
const formEl = document.forms["Book"],
      saveButton = formEl["commit"],
      <span class="bold"><strong>selectBookEl</strong></span> = formEl["selectBook"];
// set up the book selection list
<span class="bold"><strong>fillSelectWithOptions</strong></span>( Book.instances, <span class="bold"><strong>selectBookEl</strong></span>, "isbn", "title");
// when a book is selected, populate the form with its data
selectBookEl.addEventListener("change", function () {
  const bookKey = selectBookEl.value;
  if (bookKey) {  // set form fields
    const book = Book.instances[bookKey];
    ["isbn","title","year","edition"].forEach( function (p) {
      formEl[p].value = book[p] ? book[p] : "";
      // delete previous custom validation error message
      formEl[p].setCustomValidity("");
    });
  } else {
    formEl.reset();
  }
});</pre><p>There is no need to set up responsive validation for the standard
      identifier attribute <code class="code">isbn</code>, but for all other form fields,
      as shown above for the <span class="italic">Create</span> use
      case.</p><p>The logic of <code class="filename">v/deleteBook.mjs</code> for the
      <span class="italic">Delete</span> use case is similar. We only
      need to take care that the object to be deleted can be selected by
      providing a selection list, like in the <span class="italic">Update</span> use case. No validation is needed for
      the <span class="italic">Delete</span> use case.</p><p>You can <a class="link" href="http://web-engineering.info/tech/JsFrontendApp/2-ValidationApp/index.html" target="_top">run
      the validation app</a> from our server or <a class="link" href="http://web-engineering.info/tech/JsFrontendApp/2-ValidationApp.zip" target="_top">download
      the code</a> as a ZIP archive file.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1288"></a>8.&nbsp;Possible Variations and Extensions</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1290"></a>8.1.&nbsp;Adding an object-level validation function</h3></div></div></div><p>When object-level validation (across two or more properties) is
      required for a model class, we can add a custom validation function
      <code class="code">validate</code> to it, such that object-level validation can be
      performed before save by invoking <code class="code">validate</code> on the object
      concerned. For instance, for expressing the constraint defined in the
      class model shown in <a class="xref" href="#figObjLevelConstr" title="Figure&nbsp;1.1.&nbsp;An example of an object-level constraint">Figure&nbsp;1.1</a>, we define the following validation
      function:</p><pre class="programlisting">Author.prototype.<span class="bold"><strong>validate</strong></span> = function () {
  if (this.dateOfDeath &amp;&amp; this.dateOfDeath &lt; this.dateOfBirth) {
    throw new ConstraintViolation(
          "The dateOfDeath must be after the dateOfBirth!");
  }
};</pre><p>When a <code class="code">validate</code> function has been defined for a model
      class, it can be invoked in the create and update methods. For
      instance,</p><pre class="programlisting">Author.add = function (slots) {
  var author = null;
  try {
    author = new Author( slots);
    <span class="bold"><strong>author.validate</strong></span>();
  } catch (e) {
    console.log( e.constructor.name +": "+ e.message);
  }
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1302"></a>8.2.&nbsp;Using implicit JS setters</h3></div></div></div><p>Since ES5, JavaScript has its own form of setters,<a class="indexterm" name="d5e1305"></a> which are implicit and allow having the same semantics as
      explicit setter methods, but with the simple syntax of direct access. In
      addition to having the advantage of a simpler syntax, implicit JS
      setters are also safer than explicit setters because they decrease the
      likelihood of a programmer circumventing a setter by using a direct
      property assignment when instead a setter should be used. In other OOP
      languages, like Java, this is prevented by declaring properties to be
      'private'. But JavaScript does not have this option.</p><p>The following code defines implicit setter and getter methods for
      the property <code class="code">title</code>:</p><pre class="programlisting">Object.defineProperty( Book.prototype, "title", {
  <span class="bold"><strong>set</strong></span>: function(t) {
    var validationResult = Book.checkTitle( t);
    if (validationResult instanceof NoConstraintViolation) {
      this.<span class="bold"><strong>_title</strong></span> = t;
    } else {
      throw validationResult;
    }
  },
  <span class="bold"><strong>get</strong></span>: function() {
    return this.<span class="bold"><strong>_title</strong></span>;
  }
});</pre><p>Notice that, also in the constructor definition, the internal
      property <code class="code">_title</code>, used for storing the property value, is
      not used for setting/getting it, but rather the virtual property
      <code class="code">title</code>:</p><pre class="programlisting">Book = function (slots) {
  this.learnUnitNo = 0;
  this.title = "";
  if (arguments.length &gt; 0) {
    this.learnUnitNo = slots.learnUnitNo;
    this.title = slots.title;
    // optional property
    if (slots.subjectArea) this.subjectArea = slots.subjectArea;
  }
});</pre><p>We will start using implicit setter and getter methods, along with
      ES2015 class definitions, in  <span class="phrase">our 3rd tutorial on enumeration
      attributes.</span></p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1321"></a>9.&nbsp;Points of Attention</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1323"></a>9.1.&nbsp;Boilerplate code</h3></div></div></div><p>An issue with the do-it-yourself code of this example app is the
      <span class="italic">boilerplate code</span><a class="indexterm" name="d5e1327"></a> needed </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>per model class for the storage management methods
            <code class="code">add</code>, <code class="code">update</code>, <code class="code">destroy</code>,
            etc.;</p></li><li class="listitem"><p>per model class and property for getters, setters and
            validation checks.</p></li></ol></div><p>While it is good to write this code a few times for
      learning app development, you don't want to write it again and again
      later when you work on real projects. In <span class="phrase">our
      <a class="link" href="http://web-engineering.info/tech/mODELcLASSjs/validation-tutorial.html" target="_top">mODELcLASSjs
      tutorial</a>,</span> 
      we present an approach how to put these methods in a generic form in a
      meta-class, such that they can be reused in all model classes of an
      app.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1339"></a>9.2.&nbsp;Configuring the UI for preventing invalid user input</h3></div></div></div><p>Many of the new HTML5 input field types (like <code class="code">number</code>,
      <code class="code">tel</code>, <code class="code">email</code>, <code class="code">url</code>,
      <code class="code">date</code> (together with <code class="code">datetime-local</code>,
      <code class="code">time</code> and <code class="code">month</code>) or <code class="code">color</code>) are
      intended to allow web browsers rendering corresponding
      <code class="code">input</code> elements in the form of UI widgets (like a <span class="italic">date</span> picker or a <span class="italic">color</span> picker) that limit the user's input
      options such that only valid input is possible. In terms of usability,
      it's preferable to prevent users from entering invalid data instead of
      allowing to enter it and only then checking its validity and reporting
      errors.</p><p>Input fields for decimal number input should not be defined
      like</p><pre class="programlisting">&lt;input type="number" name="..." /&gt;</pre><p>but rather like</p><pre class="programlisting">&lt;input type="text" inputmode="decimal" name="..." /&gt;</pre><p>because this provides for a better user experience on mobile
      phones.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1359"></a>9.3.&nbsp;Improving the user experience by showing helpful auto-complete
      suggestions</h3></div></div></div><p>While browsers have heuristics for showing auto-complete
      suggestions, you cannot rely on them, and should better add the
      <code class="code">autocomplete</code> attribute with a suitable value. For instance,
      in iOS Safari, setting the input type to "tel" does only show
      auto-complete suggestions if <code class="code">autocomplete="tel"</code> is
      added.</p><p><a class="link" href="https://html.spec.whatwg.org/multipage/form-control-infrastructure.html%23inappropriate-for-the-control" target="_top">HTML5
      defines more than 50 possible values</a> for the
      <code class="code">autocomplete</code> attribute. So, you have to make an effort
      looking up the one that best suits your purposes.</p><p>You can also create your own custom auto-complete functionality
      with <a class="link" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/datalist" target="_top"><code class="code">datalist</code></a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1370"></a>10.&nbsp;Quiz Questions</h2></div></div></div><p>If you would like to look up the answers for the following quiz
    questions, you can check our <a class="link" href="http://web-engineering.info/forum/12" target="_top">discussion forum</a>.
    If you don't find an answer in the forum, you may create a post asking for
    an answer to a particular question.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1374"></a>10.1.&nbsp;Question 1: Methods to add in JS class model</h3></div></div></div><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="150"><tr><td><img src="../fig/Publisher_methods.svg" width="150"></td></tr></table></div></div><p>Consider the simple information design model shown in the class
      diagram.</p><p>Which of the following methods have to be added to the
      <code class="code">Publisher</code> class in a corresponding JS class model? Select
      one or many:</p><p>&#9744; <code class="code">checkName( n: String): ConstraintViolation</code></p><p>&#9744; <code class="code">getName(): String</code></p><p>&#9744; <span class="underline"><code class="code">setName( n:
      String)</code></span></p><p>&#9744; <code class="code">checkNameAsId( n: String):
      ConstraintViolation</code></p><p>&#9744; <span class="underline"><code class="code">checkNameAsId( n: String):
      ConstraintViolation</code></span></p><p>&#9744; <span class="underline"><code class="code">checkName( n: String):
      ConstraintViolation</code></span></p><p>&#9744; <code class="code">setName( n: String)</code></p><p>Notice that an underlined method name denotes a class-level
      ("static") method.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1401"></a>10.2.&nbsp;Question 2: Implementing constraints</h3></div></div></div><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="240"><tr><td><img src="../fig/PersonConstraints2.svg" width="240"></td></tr></table></div></div><p>Consider the constraints specified for the object type
      <code class="code">Person</code> in the class diagram.</p><p>Which of the following JavaScript code fragments implements these
      constraints? Select one:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>O</p><pre class="programlisting">if (name === undefined) {
  return "A name is required!";
} else if (typeof name !== "string" || name.trim() === "") {
  return "Name must be a non-empty string!";
} else if (age !== undefined) {
  if (!Number.isInteger( age) || age &lt; 0) {
    return "Age must be a non-negative integer!"
  }
} else return "";  // no error</pre></li><li class="listitem"><p>O</p><pre class="programlisting">if (name === undefined) {
  return "A name is required!";
} else if (typeof name !== "string") {
  return "Name must be a string!";
} else if (age !== undefined) {
  if (!Number.isInteger( age) || age &lt; 0) {
    return "Age must be a non-negative integer!"
  }
} else return "";  // no error</pre></li><li class="listitem"><p>O</p><pre class="programlisting">if (name === undefined) {
  return "A name is required!";
} else if (typeof name !== "string" || name.trim() === "") {
  return "Name must be a non-empty string!";
} else if (age &lt; 0) {
    return "Age must be a non-negative integer!"
} else return "";  // no error</pre></li><li class="listitem"><p>O</p><pre class="programlisting">if (name === undefined) {
  return "A name is required!";
} else if (typeof name !== "string" || name.trim() === "") {
  return "Name must be a non-empty string!";
} else if (age === undefined || !Number.isInteger( age) || age &lt; 0) {
    return "Age must be a non-negative integer!"
} else return "";  // no error</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1423"></a>10.3.&nbsp;Question 3: Implementing setter methods</h3></div></div></div><p>Which of the following code fragments represents a correct setter
      method for an ID attribute <code class="code">isbn</code>? Select one or more:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>O</p><pre class="programlisting">Book.prototype.setIsbn = function (i) {
  const validationResult = this.checkIsbn(i);
  if (validationResult instanceof NoConstraintViolation) {
    this.isbn = i;
  } else {
    throw validationResult;
  }
};</pre></li><li class="listitem"><p>O</p><pre class="programlisting">Book.prototype.setIsbn = function (i) {
  if (Book.checkIsbn(i)) {
    this.isbn = i;
  } else {
    console.log(`${i} is not a valid ISBN!`);
  }
};</pre></li><li class="listitem"><p>O</p><pre class="programlisting">Book.prototype.setIsbn = function (i) {
  const validationResult = this.checkIsbnAsId(i);
  if (validationResult instanceof NoConstraintViolation) {
    this.isbn = i;
  } else {
    throw validationResult;
  }
};</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1437"></a>11.&nbsp;Practice Project</h2></div></div></div><p>The purpose of the app to be built is managing information about
    movies. Like in the book data management app discussed in the tutorial,
    you can make the simplifying assumption that all the data can be kept in
    main memory. Persistent data storage is implemented with JavaScript's
    Local Storage API.</p><p>The app deals with just one object type: <code class="code">Movie</code>, as
    depicted in <a class="xref" href="#figMovieValApp" title="Figure&nbsp;2.2.&nbsp;The object type Movie defined with several constraints">Figure&nbsp;2.2</a>
    below. In the subsequent parts of the tutorial, you will extend this
    simple app by adding enumeration-valued attributes, as well as actors and
    directors as further model classes, and the associations between
    them.</p><div class="figure"><a name="figMovieValApp"></a><p class="title"><b>Figure&nbsp;2.2.&nbsp;The object type <code class="code">Movie</code> defined with several
      constraints</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="300"><tr><td><img src="../fig/Movie_DesM.svg" width="300" alt="The object type Movie defined with several constraints"></td></tr></table></div></div></div><br class="figure-break"><p>In this model, the following constraints have been
    expressed:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Due to the fact that the <code class="code">movieId</code> attribute is
          declared to be the <span class="italic">standard
          identifier</span> of <code class="code">Movie</code>, as expressed by the
          property annotation <code class="code">{id}</code> shown after the property
          range, it is <span class="bold"><strong><span class="italic">mandatory</span></strong></span> and <span class="bold"><strong><span class="italic">unique</span></strong></span>.</p></li><li class="listitem"><p>The <code class="code">title</code> attribute is <span class="bold"><strong><span class="italic">mandatory</span></strong></span>,
          as indicated by its multiplicity expression [1], and has a <span class="bold"><strong><span class="italic">string length
          constraint</span></strong></span> requiring its values to have at
          most 120 characters.</p></li><li class="listitem"><p>The <code class="code">releaseDate</code> attribute has an <span class="bold"><strong><span class="italic">interval
          constraint</span></strong></span>: it must be greater than or equal
          to 1895-12-28.</p></li></ol></div><p>Notice that the <code class="code">releaseDate</code> attribute is not mandatory,
    but <span class="italic">optional</span>, as indicated by its
    multiplicity expression [0..1]. In addition to the constraints described
    in this list, there are the implicit range constraints defined by
    assigning the datatype <code class="code">PositiveInteger</code> to
    <code class="code">movieId</code>, <code class="code">NonEmptyString</code> to <code class="code">title</code>,
    and <code class="code">Date</code> to <code class="code">releaseDate</code>. In our plain JavaScript
    approach, all these property constraints are coded in the model class
    within property-specific <span class="italic">check</span>
    functions.</p><p>Following the tutorial, you have to take care of</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>adding for every property a <span class="italic"><span class="bold"><strong>check</strong></span></span> function that validates the
        constraints defined for the property, and a <span class="italic"><span class="bold"><strong>setter</strong></span></span>
        method that invokes the check function and is to be used for setting
        the value of the property,</p></li><li class="listitem"><p><span class="italic"><span class="bold"><strong>performing
        validation</strong></span></span> before any data is saved in the
        <code class="code">Movie.add</code> and <code class="code">Movie.update</code> methods.</p></li></ol></div><p>in the <span class="italic">model</span> code of your app,
    while In the <span class="italic">user interface</span> ("view")
    code you have to take care of</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>styling the user interface with CSS rules (by integrating a CSS
        library such as Yahoo's Pure CSS),</p></li><li class="listitem"><p><span class="italic"><span class="bold"><strong>validation on user
        input</strong></span></span> for providing immediate feedback to the
        user,</p></li><li class="listitem"><p><span class="italic"><span class="bold"><strong>validation on form
        submission</strong></span></span> for preventing the submission of
        invalid data.</p></li></ol></div><p>You can use the following sample data for testing your app: </p><div class="table"><a name="d5e1512"></a><p class="title"><b>Table&nbsp;2.2.&nbsp;Sample data</b></p><div class="table-contents"><table frame="box" rules="all"><thead><tr>
            <th>Movie ID</th>

            <th>Title</th>

            <th>Release date</th>
          </tr></thead><tbody><tr>
            <td>1</td>

            <td>Pulp Fiction</td>

            <td>1994-05-12</td>
          </tr><tr>
            <td>2</td>

            <td>Star Wars</td>

            <td>1977-05-25</td>
          </tr><tr>
            <td>3</td>

            <td>Casablanca</td>

            <td>1943-01-23</td>
          </tr><tr>
            <td>4</td>

            <td>The Godfather</td>

            <td>1972-03-15</td>
          </tr></tbody></table></div></div><p><br class="table-break"></p><p>In this project, and in all further projects, you have to make sure
    that your pages comply with the XML syntax of HTML5 (by means of XHTML5
    validation), and that your JavaScript code complies with our <a class="link" href="http://oxygen.informatik.tu-cottbus.de/webeng/Coding-Guidelines.html" target="_top">Coding
    Guidelines</a> and is checked with JSHint (<a class="link" href="http://www.jshint.com/" target="_top">http://www.jshint.com</a>).</p></div></div></div></body></html>